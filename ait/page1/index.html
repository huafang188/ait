<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Èìæ‰∏äÈí±ÂåÖ | On-chain Wallet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles-confetti@2.12.0/tsparticles.confetti.bundle.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap');
        body { background: linear-gradient(180deg, #e0f2fe 0%, #ffffff 100%); min-height: 100vh; overflow-x: hidden; }
        .tech-title {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(90deg, #60a5fa, #a855f7, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.1));
        }
        .glass-card { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); border-radius: 1.25rem; }
        #tsparticles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .blur-text { filter: blur(5px); user-select: none; }
        [x-cloak] { display: none !important; }
        select { appearance: none; }
    </style>
</head>
<body x-data="walletApp()" x-init="init()">
    <div id="tsparticles"></div>

    <header class="flex justify-between items-center p-4 sticky top-0 z-50 glass-card mx-2 mt-2 shadow-sm">
        <div class="flex items-center space-x-2 truncate">
            <img src="https://s1.aigei.com/src/img/gif/8f/8fda5df49f554ae3ac99bad6c3cc5255.gif?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&e=2051020800&token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:aI_i43nsou7i8gH_zi1AuXfPCNU=" class="w-9 h-9 rounded-full shadow-inner" alt="logo">
            <h1 class="tech-title text-base sm:text-lg font-bold italic" x-text="t('title')"></h1>
        </div>
        <select x-model="lang" @change="changeLang" class="bg-blue-600 text-yellow-300 text-xs font-bold rounded-full px-4 py-2 outline-none border-none shadow-lg cursor-pointer">
            <template x-for="(name, code) in languages" :key="code">
                <option :value="code" x-text="name" class="bg-white text-blue-900"></option>
            </template>
        </select>
    </header>

    <main class="p-3 max-w-md mx-auto space-y-5">
        
        <div class="glass-card p-5 space-y-4 shadow-xl border-b-2 border-indigo-200">
            <template x-if="!isLoggedIn">
                <input type="text" x-model="walletAddress" :placeholder="t('inputPlaceholder')" 
                       class="w-full p-3 rounded-xl border border-blue-100 bg-white focus:ring-2 focus:ring-blue-400 outline-none text-sm transition-all">
            </template>
            <template x-if="isLoggedIn">
                <div class="flex items-center justify-between bg-indigo-50 p-3 rounded-xl border border-indigo-100">
                    <span class="text-xs font-mono text-indigo-600 font-bold" x-text="shortenAddress(walletAddress)"></span>
                    <span class="text-[10px] bg-green-500 text-white px-2 py-0.5 rounded-full font-bold">Online</span>
                </div>
            </template>
            
            <div class="flex gap-2">
                <button @click="login" class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition flex items-center justify-center" :disabled="loading">
                    <span x-show="loading" class="mr-2 animate-spin">‚öΩ</span>
                    <span x-text="isLoggedIn ? t('refreshData') : t('connectBtn')"></span>
                </button>
                <button x-show="isLoggedIn" @click="logout" class="px-4 bg-red-50 text-red-500 rounded-xl font-bold border border-red-100" x-text="t('logout')"></button>
            </div>
        </div>

<div class="glass-card p-4 shadow-md border-t-4 border-indigo-400">
    <button @click="showMiners = !showMiners" class="w-full flex justify-between items-center font-bold text-indigo-900 mb-2 outline-none">
        <div class="flex items-center">
            <span class="mr-2">üåè</span> <span x-text="t('minerModule')"></span>
        </div>
        <span class="text-xs text-indigo-400" x-text="showMiners ? 'Êî∂Ëµ∑ ‚ñ≤' : 'Â±ïÂºÄ ‚ñº'"></span>
    </button>
    
    <div x-show="showMiners" x-transition.opacity class="space-y-4 pt-2">
        <div class="grid grid-cols-4 gap-2">
            <template x-if="!isLoggedIn || userData.miners.length === 0">
                <template x-for="i in 4"><div class="h-16 bg-gray-100/50 rounded-xl flex items-center justify-center text-gray-300 text-xs">OFF</div></template>
            </template>
            <template x-if="isLoggedIn">
                <template x-for="m in userData.miners">
                    <div class="text-center p-2 bg-white rounded-xl border border-blue-50 shadow-sm">
                        <div class="text-2xl mb-1">üíé</div>
                        <div class="text-[9px] text-gray-500 flex justify-center items-center">
                            <span x-text="m.id"></span>
                        </div>
                        <div class="text-[9px] font-bold text-orange-500 mt-1" x-text="m.days + ' Days'"></div>
                    </div>
                </template>
            </template>
        </div>
        <div class="grid grid-cols-2 gap-3">
            <div class="bg-indigo-50/50 p-3 rounded-xl">
                <p class="text-[10px] text-gray-400 mb-1" x-text="t('dailyOutput')"></p>
                <p class="font-bold text-sm text-indigo-700" x-text="isLoggedIn ? userData.dailyOutput + ' AIT' : '****'"></p>
            </div>
            <div class="bg-purple-50/50 p-3 rounded-xl">
                <p class="text-[10px] text-gray-400 mb-1" x-text="t('lockedAmount')"></p>
                <p class="font-bold text-sm text-purple-700" x-text="isLoggedIn ? userData.lockedAmount + ' AIT' : '****'"></p>
            </div>
        </div>
    </div>
</div>

                <div class="bg-blue-50/50 p-3 rounded-xl">
                    <p class="text-[11px] text-blue-800 mb-2 leading-tight font-medium" x-text="t('rechargeTip')"></p>
                    <a href="https://app.tonkeeper.com/transfer/aigoodtalk.ton" 
                       class="block w-full text-center bg-white text-blue-600 py-2.5 rounded-lg text-xs font-bold border border-blue-100 shadow-sm" x-text="t('rechargeBtn')"></a>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-indigo-50/50 p-3 rounded-xl border border-indigo-100">
                        <p class="text-[10px] text-gray-400 mb-1" x-text="t('dailyOutput')"></p>
                        <p class="font-bold text-sm text-indigo-700 flex items-center">
                            <img src="https://cdn.pixabay.com/photo/2019/01/01/14/55/calendar-3906791_1280.jpg" class="mr-1 w-4 h-4 rounded-full">
                            <span :class="!isLoggedIn && 'blur-text'" x-text="isLoggedIn ? userData.dailyOutput + ' AIT' : '****'"></span>
                        </p>
                    </div>
                    <div class="bg-purple-50/50 p-3 rounded-xl border border-purple-100">
                        <p class="text-[10px] text-gray-400 mb-1" x-text="t('lockedAmount')"></p>
                        <p class="font-bold text-sm text-purple-700 flex items-center">
                            <img src="https://cdn.pixabay.com/photo/2019/10/06/11/40/lock-4529981_1280.png" class="mr-1 w-4 h-4 rounded-full">
                            <span :class="!isLoggedIn && 'blur-text'" x-text="isLoggedIn ? userData.lockedAmount + ' AIT' : '****'"></span>
                        </p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <button @click="openModal('merge')" class="bg-indigo-600 text-white py-2.5 rounded-lg text-xs font-bold" x-text="t('mergeMiner')"></button>
                    <button @click="openModal('transferMiner')" class="bg-indigo-100 text-indigo-700 py-2.5 rounded-lg text-xs font-bold" x-text="t('transferMiner')"></button>
                </div>
            </div>
        </div>

        <div class="glass-card p-4 shadow-md">
            <div class="text-center py-4 mb-4 bg-gradient-to-b from-transparent to-blue-50/30 rounded-2xl">
                <p class="text-[11px] text-gray-400 font-bold uppercase tracking-widest" x-text="t('totalAssets')"></p>
                <p class="text-3xl font-bold text-gray-800 tracking-tight" :class="!isLoggedIn && 'blur-text'" x-text="isLoggedIn ? '$ ' + userData.totalValue : '$ ****'"></p>
            </div>

            <div class="space-y-1">
                <template x-for="coin in coins">
                    <div class="flex items-center justify-between p-3 hover:bg-white rounded-xl transition cursor-default group">
                        <div class="flex items-center space-x-3">
                            <img :src="coin.logo" class="w-10 h-10 rounded-full shadow-sm bg-gray-50">
                            <div>
                                <p class="font-bold text-gray-800 text-sm" x-text="coin.name"></p>
                                <p class="text-[10px] text-gray-400" x-text="'$'+coin.price"></p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-gray-800 text-sm" :class="!isLoggedIn && 'blur-text'" x-text="isLoggedIn ? coin.balance : '****'"></p>
                            <p class="text-[10px] text-gray-500 font-medium" :class="!isLoggedIn && 'blur-text'" x-text="isLoggedIn ? '‚âà $'+(coin.balance * coin.price).toLocaleString() : '****'"></p>
                        </div>
                    </div>
                </template>
            </div>

            <div class="grid grid-cols-3 gap-2 mt-6">
                <button @click="openModal('withdraw')" class="bg-blue-600 text-white py-2.5 rounded-xl text-xs font-bold" x-text="t('withdraw')"></button>
                <a href="https://app.tonkeeper.com/transfer/aigoodtalk.ton" class="bg-green-600 text-white py-2.5 rounded-xl text-xs font-bold text-center flex items-center justify-center" x-text="t('deposit')"></a>
                <button @click="openModal('transfer')" class="bg-orange-500 text-white py-2.5 rounded-xl text-xs font-bold" x-text="t('transfer')"></button>
            </div>
        </div>
<div class="mt-4 p-4 glass-card border-l-4 border-yellow-500 bg-yellow-50/30">
    <p class="text-[10px] text-yellow-700 mb-2 font-bold">üîã ÊØè30Â§©ÁîµË¥π‰∏∫ 345 Fuel Tokens</p>
    <button @click="openFuelModal()" class="w-full bg-gradient-to-r from-yellow-500 to-orange-600 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition">‰ΩøÁî® Fuel Token ÂÖÖÂÄºÁîµË¥π</button>
</div>
        <div class="glass-card p-4 shadow-md bg-indigo-900 text-white">
            <h3 class="font-bold text-sm mb-4 flex items-center">
                <span class="mr-2">üìä</span> <span x-text="t('swapTitle')"></span>
            </h3>
            <div class="space-y-3">
                <select x-model="swap.pair" class="w-full p-3 border-none rounded-xl text-sm bg-indigo-800 text-white outline-none">
                    <option value="AIT-USDT">AIT ‚Üí USDT (TON)</option>
                    <option value="ACT-USDT">ACT ‚Üí USDT (TON)</option>
                    <option value="AIT-ACT">AIT ‚Üí ACT</option>
                    <option value="USDT-AIT">USDT ‚Üí AIT</option>
                    <option value="TON-AIT">TON ‚Üí AIT</option>
                    <option value="AIT-Fuel Token">AIT ‚Üí Fuel Token</option>
                    <option value="USDT-Fuel Token">USDT ‚Üí Fuel Token</option>
                    <option value="TON-Fuel Token">TON ‚Üí Fuel Token</option>
                </select>
                <input type="number" x-model="swap.amount" :placeholder="t('inputAmount')" class="w-full p-3 rounded-xl text-sm bg-indigo-800 text-white placeholder-indigo-400 border-none outline-none">
                <div class="text-[10px] text-indigo-300 px-1 font-medium" x-text="t('gasTip')"></div>
                <button @click="submitSwap" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-xl font-bold text-sm shadow-lg shadow-indigo-900/50" x-text="t('executeSwap')"></button>
            </div>
        </div>

<div class="glass-card p-4 shadow-md mt-5" x-data="{ teamTab: 'members' }">
    <h3 class="font-bold text-gray-800 mb-4 flex items-center">
        <span class="mr-2">üßë‚Äçü§ù‚Äçüßë</span> ÊàëÁöÑÂõ¢Èòü
    </h3>
    <div class="flex bg-gray-100 rounded-lg p-1 mb-4">
        <button @click="teamTab = 'members'" :class="teamTab === 'members' ? 'bg-white shadow text-blue-600' : 'text-gray-500'" class="flex-1 py-1.5 rounded-md text-xs font-bold transition">Âõ¢Èòü</button>
        <button @click="teamTab = 'rewards'" :class="teamTab === 'rewards' ? 'bg-white shadow text-blue-600' : 'text-gray-500'" class="flex-1 py-1.5 rounded-md text-xs font-bold transition">Êî∂Áõä</button>
    </div>

    <div x-show="teamTab === 'members'" class="space-y-3">
        <template x-for="(label, key) in {v1:'‰∏Ä‰ª£', v2:'‰∫å‰ª£', v3:'‰∏â‰ª£', v4_17:'ÂõõÂà∞ÂçÅ‰∏É‰ª£', v18_20:'ÂçÅÂÖ´Âà∞‰∫åÂçÅ‰ª£'}">
            <div class="border-b border-gray-50 pb-2 text-[11px]">
                <p class="font-bold text-gray-700 mb-1" x-text="label"></p>
                <div class="flex justify-between text-gray-500">
                    <span>‰∫∫Êï∞: <b class="text-gray-800" x-text="isLoggedIn ? userData.team[key].count : '0'"></b></span>
                    <span>ËµÑ‰∫ßÂåÖ: <b class="text-gray-800" x-text="isLoggedIn ? userData.team[key].miners : '0'"></b></span>
                    <span>ÁîüÊïà‰∏≠: <b class="text-green-500" x-text="isLoggedIn ? userData.team[key].running : '0'"></b></span>
                </div>
            </div>
        </template>
    </div>

    <div x-show="teamTab === 'rewards'" class="space-y-2">
        <template x-for="(label, key) in {v1:'‰∏Ä‰ª£Â•ñÂä±5%', v2:'‰∫å‰ª£Â•ñÂä±3%', v3:'‰∏â‰ª£Â•ñÂä±2%', v4_17:'ÂõõÂà∞ÂçÅ‰∏É‰ª£Â•ñÂä±1%', v18_20:'ÂçÅÂÖ´Âà∞‰∫åÂçÅ‰ª£Â•ñÂä±2%'}">
            <div class="flex justify-between items-center bg-blue-50/50 p-2 rounded-lg text-[11px]">
                <span class="text-gray-600 font-medium" x-text="label"></span>
                <span class="font-bold text-blue-600" x-text="isLoggedIn ? userData.team[key].reward + ' AIT/Â§©' : '0.00'"></span>
            </div>
        </template>
    </div>
</div>

        <div class="glass-card p-4 shadow-md overflow-hidden min-h-[150px]">
            <h3 class="font-bold text-sm mb-3 text-gray-700" x-text="t('records')"></h3>
            <div class="overflow-x-auto">
                <template x-if="!isLoggedIn || logs.length === 0">
                    <div class="flex flex-col items-center justify-center py-6 text-gray-400">
                        <span class="text-2xl mb-2">üìã</span>
                        <p class="text-[10px]" x-text="isLoggedIn ? 'No records found' : t('loginToView')"></p>
                    </div>
                </template>
                <template x-if="isLoggedIn && logs.length > 0">
                    <table class="w-full text-[10px] text-left">
                        <thead class="bg-gray-50 text-gray-400 uppercase">
                            <tr>
                                <th class="p-2" x-text="t('date')"></th>
                                <th class="p-2" x-text="t('type')"></th>
                                <th class="p-2" x-text="t('amount')"></th>
                                <th class="p-2" x-text="t('status')"></th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-50">
                            <template x-for="log in logs">
                                <tr>
                                    <td class="p-2 whitespace-nowrap text-gray-500" x-text="log.date"></td>
                                    <td class="p-2 font-medium" x-text="log.type"></td>
                                    <td class="p-2 font-bold" x-text="log.amount"></td>
                                    <td class="p-2 font-bold" 
                                        :class="{
                                          'text-green-500': log.status === 'Success' || log.status === 'ÊàêÂäü',
                                          'text-orange-500': log.status === 'Pending' || log.status === 'Â§ÑÁêÜ‰∏≠',
                                          'text-red-500': log.status === 'Failed' || log.status === 'Â§±Ë¥•',
                                          'text-blue-500': log.status === 'Â∑≤Ëá™Âä®ÊâßË°å'
                                        }" 
                                        x-text="log.status">
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </template>
            </div>
        </div>

        <footer class="text-center text-[10px] text-gray-400 py-8 border-t border-gray-100">
            <p>¬© 2026 AI Chain Wallet Technology. All Rights Reserved.</p>
        </footer>
    </main>

    <div x-show="modal.show" x-cloak class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm">
        <div class="bg-white rounded-3xl w-full max-w-xs p-6 shadow-2xl relative">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-extrabold text-gray-800" x-text="modal.title"></h3>
                <button @click="modal.show = false" class="bg-gray-100 p-1 rounded-full text-gray-400 hover:text-red-500">‚úï</button>
            </div>
            
            <div class="space-y-4">
                <template x-if="['withdraw', 'transfer'].includes(modal.type)">
                    <div class="space-y-1">
                        <label class="text-[10px] text-gray-400 font-bold ml-1">SELECT TOKEN</label>
                        <select x-model="modal.coin" class="w-full p-3 bg-gray-50 border-none rounded-xl text-sm outline-none ring-1 ring-gray-100 focus:ring-2 focus:ring-blue-500">
                            <template x-for="coin in coins">
                                <option :value="coin.name" x-text="coin.name"></option>
                            </template>
                        </select>
                    </div>
                </template>

                <div class="space-y-1">
                    <label class="text-[10px] text-gray-400 font-bold ml-1">AMOUNT</label>
                    <input type="number" x-model="modal.amount" placeholder="0.00" class="w-full p-3 bg-gray-50 border-none rounded-xl text-sm outline-none ring-1 ring-gray-100 focus:ring-2 focus:ring-blue-500">
                </div>
                
                <template x-if="modal.type === 'transfer' || modal.type === 'transferMiner'">
                    <div class="space-y-1">
                        <label class="text-[10px] text-gray-400 font-bold ml-1">RECIPIENT ADDRESS</label>
                        <input type="text" x-model="modal.target" :placeholder="t('targetAddr')" class="w-full p-3 bg-gray-50 border-none rounded-xl text-sm outline-none ring-1 ring-gray-100 focus:ring-2 focus:ring-blue-500">
                    </div>
                </template>

                <div class="p-3 bg-blue-50 rounded-xl border border-blue-100">
                    <p class="text-[10px] text-blue-600 font-medium leading-relaxed" x-text="t('gasTip')"></p>
                </div>

                <button @click="handleModalSubmit" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-100 transition active:scale-95" x-text="t('confirm')"></button>
            </div>
        </div>
    </div>

<script>
    function walletApp() {
        return {
            // --- 1. ÈÖçÁΩÆ‰∏éÂü∫Á°ÄÁä∂ÊÄÅ ---
            API_URL: 'https://script.google.com/macros/s/AKfycbwRIrysX2031j2M7c_lz4FfIJKSXOrqQmxIy4f8Ez0jt8B2pe-ndYDbVc3Xs-A6X_zY/exec',
            lang: 'zh-CN',
            isLoggedIn: false,
            loading: false,
            walletAddress: '',
            showMiners: false, 
            
            // ÂêÑÊ®°ÂùóË°®ÂçïÊ®°Âûã
            swap: { pair: 'AIT-USDT', amount: '' },
            fuelModal: { show: false, days: '30', ids: '' }, // daysÂç≥Âë®Êúü
            modal: { show: false, type: '', title: '', amount: '', target: '', coin: 'AIT' },
            
            // --- 2. ÁøªËØëÂ≠óÂÖ∏ ---
            languages: {
                'zh-CN': 'ÁÆÄ‰Ωì‰∏≠Êñá', 'zh-TW': 'ÁπÅÈ´î‰∏≠Êñá', 'ja': 'Êó•Êú¨Ë™û', 'ko': 'ÌïúÍµ≠Ïñ¥',
                'ms': 'Melayu', 'ru': '–†—É—Å—Å–∫–∏–π', 'fr': 'Fran√ßais', 'de': 'Deutsch', 'es': 'Espa√±ol'
            },
            translations: {
                'zh-CN': {
                    title: 'Èìæ‰∏äÈí±ÂåÖ', inputPlaceholder: 'Âú®Ê≠§ËæìÂÖ•ÊÇ®ÁöÑÈí±ÂåÖÂú∞ÂùÄ', connectBtn: 'ËøûÊé•Èí±ÂåÖ', refreshData: 'Êõ¥Êñ∞Êï∞ÊçÆ', logout: 'ÈÄÄÂá∫',
                    minerModule: 'ÊàëÁöÑËµÑ‰∫ßÂåÖ', rechargeTip: 'ÂÖÖÂÄºÊÇ®ÁöÑÈìæ‰∏äËµÑ‰∫ß', rechargeBtn: 'Èí±ÂåÖÂÖÖÂÄº',
                    dailyOutput: 'ÊØèÊó•‰∫ßÁßØÂàÜ', lockedAmount: 'ÈîÅ‰ªìÊï∞Èáè', mergeMiner: 'ÂêàÊàêËµÑ‰∫ßÂåÖ', transferMiner: 'ËµÑ‰∫ßÂåÖËΩ¨ËÆ©',
                    totalAssets: 'Èí±ÂåÖÊÄªËµÑ‰∫ß (USD)', withdraw: 'ÊèêÁé∞', deposit: 'ÂÖÖÂÄº', transfer: 'ËΩ¨Ë¥¶', swapTitle: 'Èó™ÁîµÂÖëÊç¢',
                    executeSwap: 'Á´ãÂç≥ÂÖëÊç¢', records: '‰∫§ÊòìËÆ∞ÂΩï', date: 'Êó∂Èó¥', type: 'Êìç‰Ωú', amount: 'Êï∞È¢ù', status: 'Áä∂ÊÄÅ',
                    inputAmount: 'ËæìÂÖ•Êï∞Èáè (10.56)', gasTip: 'GasË¥πÁî® (0.0TON)ÔºåÊèê‰∫§ÂêéÂçÅÂàÜÈíüÂÜÖÂ§ÑÁêÜ', confirm: 'Á°ÆËÆ§Êìç‰Ωú',
                    targetAddr: 'ËØ∑ËæìÂÖ•Êé•Êî∂ËÄÖÈí±ÂåÖÂú∞ÂùÄ', success: 'Êèê‰∫§ÊàêÂäüÔºÅ', loginToView: 'ËØ∑ÂÖàËøûÊé•Èí±ÂåÖÊü•ÁúãËÆ∞ÂΩï'
                },
                    'zh-TW': {
                        title: 'Èèà‰∏äÈå¢ÂåÖ', inputPlaceholder: 'Âú®Ê≠§Ëº∏ÂÖ•ÊÇ®ÁöÑÈå¢ÂåÖÂú∞ÂùÄ', connectBtn: 'ÈÄ£Êé•Èå¢ÂåÖ', refreshData: 'Êõ¥Êñ∞Êï∏Êìö', logout: 'ÈÄÄÂá∫',
                        minerModule: 'Á§¶Ê©üÂ∑•‰ΩúËá∫', basicMiner: 'ÂéüÂßãÁ§¶Ê©ü (A-Type)', rechargeTip: 'Ë´ãÂÖÖË≤ªÊôÇÂÇôË®ªÊÇ®ÁöÑÁ§¶Ê©üÁ∑®Ëôü', rechargeBtn: 'ÈõªË≤ªÂÖÖÂÄº',
                        dailyOutput: 'ÊØèÊó•Áî¢Âπ£', lockedAmount: 'ÈéñÂÄâÊï∏Èáè', mergeMiner: 'ÂêàÊàêÁØÄÈªûÁ§¶Ê©ü', transferMiner: 'ÁØÄÈªûÁ§¶Ê©üËΩâËÆì',
                        totalAssets: 'Èå¢ÂåÖÁ∏ΩË≥áÁî¢ (USD)', withdraw: 'ÊèêÂπ£', deposit: 'ÂÖÖÂÄº', transfer: 'ËΩâË≥¨', swapTitle: 'ÈñÉÈõªÂÖåÊèõ',
                        executeSwap: 'Á´ãÂç≥ÂÖåÊèõ', records: '‰∫§ÊòìË®òÈåÑ', date: 'ÊôÇÈñì', type: 'Êìç‰Ωú', amount: 'Êï∏È°ç', status: 'ÁãÄÊÖã',
                        inputAmount: 'Ëº∏ÂÖ•Êï∏Èáè (10.56)', gasTip: 'GasË≤ªÁî® (0.0TON)ÔºåÊèê‰∫§ÂæåÂçÅÂàÜÈêòÂÖßËôïÁêÜ', confirm: 'Á¢∫Ë™çÊìç‰Ωú',
                        targetAddr: 'Ë´ãËº∏ÂÖ•Êé•Êî∂ËÄÖÈå¢ÂåÖÂú∞ÂùÄ', success: 'Êèê‰∫§ÊàêÂäüÔºÅ', loginToView: 'Ë´ãÂÖàÈÄ£Êé•Èå¢ÂåÖÊü•ÁúãË®òÈåÑ'
                    },
                    'ja': {
                        title: '„Ç™„É≥„ÉÅ„Çß„Éº„É≥Ë≤°Â∏É', inputPlaceholder: '„Ç¶„Ç©„É¨„ÉÉ„Éà„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ', connectBtn: 'ÈÄ£Êê∫', refreshData: '„Éá„Éº„ÇøÊõ¥Êñ∞', logout: '„É≠„Ç∞„Ç¢„Ç¶„Éà',
                        minerModule: '„Éû„Ç§„Éä„Éº„Éë„Éç„É´', basicMiner: 'Âü∫Êú¨„Éû„Ç§„Éä„Éº', rechargeTip: '„É™„ÉÅ„É£„Éº„Ç∏ÊôÇ„Å´„Éû„Ç§„Éä„ÉºID„ÇíË®òÂÖ•', rechargeBtn: 'ÈõªÊ∞ó‰ª£„É™„ÉÅ„É£„Éº„Ç∏',
                        dailyOutput: 'Êó•Ê¨°ÁîüÁî£', lockedAmount: '„É≠„ÉÉ„ÇØÈáè', mergeMiner: '„Éû„Ç§„Éä„ÉºÂêàÊàê', transferMiner: '„Éû„Ç§„Éä„ÉºË≠≤Ê∏°',
                        totalAssets: 'Á∑èË≥áÁî£ (USD)', withdraw: 'Âá∫Èáë', deposit: 'ÂÖ•Èáë', transfer: 'ÈÄÅÈáë', swapTitle: '„Çπ„ÉØ„ÉÉ„Éó',
                        executeSwap: '‰∫§Êèõ„Åô„Çã', records: 'Â±•Ê≠¥', date: 'Êó•‰ªò', type: '„Çø„Ç§„Éó', amount: 'Êï∞Èáè', status: 'Áä∂ÊÖã',
                        inputAmount: 'Êï∞Èáè (‰æã: 10.56)', gasTip: '„Ç¨„Çπ‰ª£ (0.0TON)„ÄÅ10ÂàÜ‰ª•ÂÜÖ„Å´ÂÆå‰∫Ü', confirm: 'Á¢∫Ë™çÈÄÅ‰ø°',
                        targetAddr: 'ÂèóÂèñ‰∫∫„Ç¢„Éâ„É¨„Çπ', success: 'ÈÄÅ‰ø°ÂÆå‰∫ÜÔºÅ', loginToView: 'ÈÄ£Êê∫„Åó„Å¶Ë®òÈå≤„ÇíË°®Á§∫'
                    },
                    'ko': {
                        title: 'Ïò®Ï≤¥Ïù∏ ÏßÄÍ∞ë', inputPlaceholder: 'ÏßÄÍ∞ë Ï£ºÏÜåÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî', connectBtn: 'ÏßÄÍ∞ë Ïó∞Í≤∞', refreshData: 'Îç∞Ïù¥ÌÑ∞ Í∞±Ïã†', logout: 'Î°úÍ∑∏ÏïÑÏõÉ',
                        minerModule: 'Ï±ÑÍµ¥Í∏∞ ÎåÄÏãúÎ≥¥Îìú', basicMiner: 'Í∏∞Î≥∏ Ï±ÑÍµ¥Í∏∞', rechargeTip: 'Ï∂©Ï†Ñ Ïãú Ï±ÑÍµ¥Í∏∞ Î≤àÌò∏Î•º Î©îÎ™®ÌïòÏÑ∏Ïöî', rechargeBtn: 'Ï†ÑÍ∏∞Î£å Ï∂©Ï†Ñ',
                        dailyOutput: 'ÏùºÏùº ÏÉùÏÇ∞Îüâ', lockedAmount: 'Ïû†Í∏¥ ÏàòÎüâ', mergeMiner: 'Ï±ÑÍµ¥Í∏∞ Ìï©ÏÑ±', transferMiner: 'Ï±ÑÍµ¥Í∏∞ ÏñëÎèÑ',
                        totalAssets: 'Ï¥ù ÏûêÏÇ∞ (USD)', withdraw: 'Ï∂úÍ∏à', deposit: 'ÏûÖÍ∏à', transfer: 'Ïù¥Ï≤¥', swapTitle: 'Ïä§Ïôë',
                        executeSwap: 'Ï¶âÏãú ÍµêÌôò', records: 'Í±∞Îûò Í∏∞Î°ù', date: 'ÎÇ†Ïßú', type: 'Ïú†Ìòï', amount: 'Í∏àÏï°', status: 'ÏÉÅÌÉú',
                        inputAmount: 'ÏàòÎüâ ÏûÖÎ†• (Ïòà: 10.56)', gasTip: 'ÏàòÏàòÎ£å (0.0TON), 10Î∂Ñ ÎÇ¥ Ï≤òÎ¶¨', confirm: 'ÏûëÏóÖ ÌôïÏù∏',
                        targetAddr: 'ÏàòÏã†Ïûê ÏßÄÍ∞ë Ï£ºÏÜå', success: 'Ï†úÏ∂ú ÏÑ±Í≥µ!', loginToView: 'ÏßÄÍ∞ë Ïó∞Í≤∞ ÌõÑ Í∏∞Î°ù ÌôïÏù∏'
                    },
                    'ms': {
                        title: 'Dompet On-chain', inputPlaceholder: 'Masukkan alamat dompet', connectBtn: 'Sambung', refreshData: 'Kemaskini', logout: 'Keluar',
                        minerModule: 'Panel Pelombong', basicMiner: 'Pelombong Asal', rechargeTip: 'Nota nombor pelombong semasa mengecas', rechargeBtn: 'Tambah Nilai',
                        dailyOutput: 'Hasil Harian', lockedAmount: 'Jumlah Terkunci', mergeMiner: 'Gabung Pelombong', transferMiner: 'Pindah Pelombong',
                        totalAssets: 'Jumlah Aset', withdraw: 'Tarik', deposit: 'Deposit', transfer: 'Pindah', swapTitle: 'Tukar',
                        executeSwap: 'Tukar Sekarang', records: 'Rekod', date: 'Tarikh', type: 'Jenis', amount: 'Jumlah', status: 'Status',
                        inputAmount: 'Masukkan jumlah', gasTip: 'Kos Gas (0.0TON), dalam 10 min', confirm: 'Sahkan',
                        targetAddr: 'Alamat penerima', success: 'Berjaya!', loginToView: 'Sambung dompet untuk rekod'
                    },
                    'ru': {
                        title: 'On-chain –ö–æ—à–µ–ª–µ–∫', inputPlaceholder: '–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞', connectBtn: '–ü–æ–¥–∫–ª—é—á–∏—Ç—å', refreshData: '–û–±–Ω–æ–≤–∏—Ç—å', logout: '–í—ã–π—Ç–∏',
                        minerModule: '–ü–∞–Ω–µ–ª—å –º–∞–π–Ω–µ—Ä–∞', basicMiner: '–ë–∞–∑–æ–≤—ã–π –º–∞–π–Ω–µ—Ä', rechargeTip: '–£–∫–∞–∑—ã–≤–∞–π—Ç–µ ID –º–∞–π–Ω–µ—Ä–∞ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ', rechargeBtn: '–û–ø–ª–∞—Ç–∞ —ç–ª-—ç–Ω–µ—Ä–≥–∏–∏',
                        dailyOutput: '–î–æ—Ö–æ–¥ –≤ –¥–µ–Ω—å', lockedAmount: '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ', mergeMiner: '–°–∏–Ω—Ç–µ–∑ —É–∑–ª–∞', transferMiner: '–ü–µ—Ä–µ–¥–∞—á–∞ –º–∞–π–Ω–µ—Ä–∞',
                        totalAssets: '–û–±—â–∏–µ –∞–∫—Ç–∏–≤—ã', withdraw: '–í—ã–≤–æ–¥', deposit: '–î–µ–ø–æ–∑–∏—Ç', transfer: '–ü–µ—Ä–µ–≤–æ–¥', swapTitle: '–û–±–º–µ–Ω',
                        executeSwap: '–û–±–º–µ–Ω—è—Ç—å', records: '–ò—Å—Ç–æ—Ä–∏—è', date: '–î–∞—Ç–∞', type: '–¢–∏–ø', amount: '–ö–æ–ª-–≤–æ', status: '–°—Ç–∞—Ç—É—Å',
                        inputAmount: '–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª-–≤–æ', gasTip: '–ì–∞–∑ (0.0TON), 10 –º–∏–Ω', confirm: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å',
                        targetAddr: '–ê–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è', success: '–£—Å–ø–µ—à–Ω–æ!', loginToView: '–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞'
                    },
                    'fr': {
                        title: 'Portefeuille On-chain', inputPlaceholder: 'Entrez l\'adresse', connectBtn: 'Connecter', refreshData: 'Actualiser', logout: 'Quitter',
                        minerModule: 'Tableau de bord', basicMiner: 'Mineur de base', rechargeTip: 'Notez le num√©ro du mineur', rechargeBtn: 'Recharger',
                        dailyOutput: 'Production/j', lockedAmount: 'Bloqu√©', mergeMiner: 'Fusionner', transferMiner: 'Transf√©rer',
                        totalAssets: 'Total actifs', withdraw: 'Retirer', deposit: 'D√©p√¥t', transfer: 'Transf√©rer', swapTitle: '√âchange',
                        executeSwap: '√âchanger', records: 'Historique', date: 'Date', type: 'Type', amount: 'Montant', status: 'Statut',
                        inputAmount: 'Entrer montant', gasTip: 'Frais (0.0TON), 10 min', confirm: 'Confirmer',
                        targetAddr: 'Adresse destinataire', success: 'Succ√®s!', loginToView: 'Connectez-vous pour voir'
                    },
                    'de': {
                        title: 'On-chain Wallet', inputPlaceholder: 'Adresse eingeben', connectBtn: 'Verbinden', refreshData: 'Aktualisieren', logout: 'Logout',
                        minerModule: 'Miner-Panel', basicMiner: 'Basis-Miner', rechargeTip: 'Miner-ID bei Zahlung angeben', rechargeBtn: 'Aufladen',
                        dailyOutput: 'Ertrag/Tag', lockedAmount: 'Gesperrt', mergeMiner: 'Fusionieren', transferMiner: '√úbertragen',
                        totalAssets: 'Gesamtverm√∂gen', withdraw: 'Auszahlen', deposit: 'Einzahlen', transfer: 'Senden', swapTitle: 'Tausch',
                        executeSwap: 'Tauschen', records: 'Verlauf', date: 'Datum', type: 'Typ', amount: 'Menge', status: 'Status',
                        inputAmount: 'Menge (z.B. 10.56)', gasTip: 'Gas (0.0TON), 10 Min', confirm: 'Best√§tigen',
                        targetAddr: 'Empf√§ngeradresse', success: 'Erfolg!', loginToView: 'Anmelden f√ºr Verlauf'
                    },
                    'es': {
                        title: 'Billetera On-chain', inputPlaceholder: 'Direcci√≥n de billetera', connectBtn: 'Conectar', refreshData: 'Actualizar', logout: 'Salir',
                        minerModule: 'Panel Miner√≠a', basicMiner: 'Minero Base', rechargeTip: 'Indique ID del minero', rechargeBtn: 'Recargar',
                        dailyOutput: 'Producci√≥n', lockedAmount: 'Bloqueado', mergeMiner: 'Fusionar', transferMiner: 'Transferir',
                        totalAssets: 'Activos Totales', withdraw: 'Retirar', deposit: 'Dep√≥sito', transfer: 'Transferir', swapTitle: 'Swap',
                        executeSwap: 'Intercambiar', records: 'Registros', date: 'Fecha', type: 'Tipo', amount: 'Cantidad', status: 'Estado',
                        inputAmount: 'Cantidad (ej: 10.56)', gasTip: 'Gas (0.0TON), 10 min', confirm: 'Confirmar',
                        targetAddr: 'Direcci√≥n receptor', success: '¬°√âxito!', loginToView: 'Conectar para ver registros'
                    }
            },


            // --- 3. Êï∞ÊçÆÊ®°Âûã ---
            userData: { 
                miners: [], totalValue: '0.00', dailyOutput: '0', lockedAmount: '0',
                team: { v1: {count:0}, v2: {count:0}, v3: {count:0}, v4_17: {count:0}, v18_20: {count:0} }
            },
            coins: [
                { name: 'AIT', balance: 0, logo: 'https://pbs.twimg.com/media/G-DbAlZbMAAgM4X?format=png&name=240x240' },
                { name: 'ACT', balance: 0, logo: 'https://pbs.twimg.com/media/G-DdXH_aAAExvdl?format=png&name=240x240' },
                { name: 'Fuel Token', balance: 0, logo: 'https://img95.699pic.com/xsj/2j/5c/rm.jpg!/fh/300' },
                { name: 'USDT', balance: 0, logo: 'https://www.coinmetro.com/_next/static/media/USDT.e5b6b9e8.svg' },
                { name: 'TON', balance: 0, logo: 'https://asset-metadata-service-production.s3.amazonaws.com/asset_icons/46db595e47fca18285c42eaa720fd4cdf3cc4940e1490ec07c77d21f2cf961cf.png' }
            ],
            logs: [],

            // --- 4. Ê†∏ÂøÉÈÄªËæë ---
            init() {
                const saved = localStorage.getItem('onchain_wallet_addr');
                if(saved) {
                    this.walletAddress = saved;
                    this.login();
                }
            },

            t(key) { 
                return (this.translations[this.lang] && this.translations[this.lang][key]) || this.translations['zh-CN'][key]; 
            },

            // Áªü‰∏ÄÁöÑPOSTËØ∑Ê±ÇÂ§ÑÁêÜÂô® (Êõø‰ª£ÂéüÊù•ÁöÑ postData)
            async requestPost(payload) {
                this.loading = true;
                try {
                    const response = await fetch(this.API_URL, {
                        method: 'POST',
                        body: JSON.stringify(payload)
                    });
                    const res = await response.json();
                    alert(res.message); // ÊòæÁ§∫ÂêéÁ´ØÁöÑÊàêÂäüÊàñÈîôËØØÊèêÁ§∫
                    if (res.status === 'success') {
                        setTimeout(() => this.login(), 1000); // ÊàêÂäüÂêéËá™Âä®Âà∑Êñ∞
                        return true;
                    }
                } catch (e) {
                    console.error("Post Error:", e);
                    alert("ÁΩëÁªúÂºÇÂ∏∏ÔºåËØ∑Á®çÂêéÂÜçËØï");
                } finally {
                    this.loading = false;
                }
                return false;
            },

            async login() {
                if(!this.walletAddress || this.walletAddress.length < 5) return;
                this.loading = true;
                try {
                    const response = await fetch(`${this.API_URL}?address=${this.walletAddress}`);
                    const data = await response.json();
                    if(data.user) {
                        this.userData.totalValue = data.user.total || '0.00';
                        this.userData.dailyOutput = data.user.daily || '0';
                        this.userData.lockedAmount = data.user.locked || '0';
                        this.userData.miners = data.miners || [];
                        this.userData.team = data.user.team || this.userData.team;
                        this.logs = data.logs || [];
                        this.coins.forEach(c => {
                            if(data.user.balances) c.balance = data.user.balances[c.name] || 0;
                        });
                        this.isLoggedIn = true;
                        localStorage.setItem('onchain_wallet_addr', this.walletAddress);
                    }
                } catch (e) { console.error("Login Error:", e); }
                finally { this.loading = false; }
            },

            // 1. ËΩ¨Ë¥¶„ÄÅÊèêÁé∞„ÄÅÂêàÊàê„ÄÅËΩ¨ËÆ©ÁöÑÂÖ•Âè£
            async handleModalSubmit() {
                const type = this.modal.type;
                const payload = {
                    user: this.walletAddress,
                    amount: this.modal.amount,
                    coin: this.modal.coin,
                    target: this.modal.target,
                    action: ''
                };

                // Ê†πÊçÆÁ±ªÂûãÂåπÈÖçÂêéÁ´Ø Action
                if (type === 'transfer_pkg') payload.action = 'TRANSFER_PKG';
                else if (type === 'TRANSFER') payload.action = 'TRANSFER';
                else if (type === 'WITHDRAW') payload.action = 'WITHDRAW';
                else if (type === 'MINER_MERGE') payload.action = 'MINER_MERGE';

                if (await this.requestPost(payload)) {
                    this.modal.show = false;
                    this.modal.amount = '';
                    this.modal.target = '';
                }
            },

            // 2. ÂÖëÊç¢ÈÄªËæë
            async submitSwap() {
                if (!this.swap.amount) return alert("Enter amount");
                const payload = {
                    user: this.walletAddress,
                    action: 'SWAP',
                    pair: this.swap.pair,
                    amount: this.swap.amount
                };
                if (await this.requestPost(payload)) {
                    this.swap.amount = '';
                }
            },

            // 3. ÁîµË¥πÂÖÖÂÄºÈÄªËæë
            async submitFuelRecharge() {
                if(!this.fuelModal.ids) return alert("ËØ∑ËæìÂÖ•ÁüøÊú∫ÁºñÂè∑");
                const payload = {
                    user: this.walletAddress,
                    action: 'FUEL_RECHARGE',
                    duration: this.fuelModal.days,
                    minerIds: this.fuelModal.ids
                };
                if (await this.requestPost(payload)) {
                    this.fuelModal.show = false;
                }
            },

            // --- ËæÖÂä© UI ÊñπÊ≥ï ---
            openModal(type) {
                if(!this.isLoggedIn) return alert("Please connect wallet");
                this.modal.type = type;
                this.modal.title = this.t(type);
                this.modal.show = true;
            },
            logout() {
                localStorage.removeItem('onchain_wallet_addr');
                location.reload(); 
            },
            shortenAddress(addr) { 
                return addr ? addr.slice(0,6) + '...' + addr.slice(-4) : ''; 
            }
        }
    }
</script>

<div 
    x-show="fuelModal.show" 
    x-cloak 
    class="fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0 scale-90"
    x-transition:enter-end="opacity-100 scale-100"
>
    <div class="bg-white rounded-3xl w-full max-w-xs p-6 shadow-2xl" @click.away="fuelModal.show = false">
        <h3 class="font-bold text-gray-800 mb-4 flex items-center">
            <span class="mr-2">üîã</span> ÁîµË¥πÂÖÖÂÄº (Fuel Token)
        </h3>
        
        <div class="space-y-4">
            <div>
                <label class="text-[10px] font-bold text-gray-400 block mb-1">ÈÄâÊã©Âë®Êúü</label>
                <select x-model="fuelModal.days" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm border border-gray-100 focus:border-orange-500 transition">
                    <option value="30">30Â§© (345 Fuel)</option>
                    <option value="90">90Â§© (1035 Fuel)</option>
                    <option value="180">180Â§© (2070 Fuel)</option>
                    <option value="360">360Â§© (4140 Fuel)</option>
                </select>
            </div>
            
            <div>
                <label class="text-[10px] font-bold text-gray-400 block mb-1">ËµÑ‰∫ßÂåÖ</label>
                <input 
                    type="text" 
                    x-model="fuelModal.ids" 
                    placeholder="‰æãÂ¶Ç: A-00001Ôºå'B-00001" 
                    class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm border border-gray-100 focus:border-orange-500 transition"
                >
            </div>

            <button 
                @click="submitFuelRecharge" 
                class="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition"
            >
                Á´ãÂç≥Êèê‰∫§
            </button>
            
            <button @click="fuelModal.show = false" class="w-full text-gray-400 text-xs">ÂèñÊ∂à</button>
        </div>
    </div>
</div>

</body>
</html>


