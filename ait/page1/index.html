<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é“¾ä¸Šé’±åŒ… | On-chain Wallet</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://lib.baomitu.com/alpinejs/3.12.0/cdn.min.js"></script>
    <script src="https://lib.baomitu.com/tsparticles-confetti/2.12.0/tsparticles.confetti.bundle.min.js"></script>

<style>
    /* 1. å…¨å±€å­—ä½“åŠé•œåƒå­—ä½“åŠ è½½ */
    @import url('https://fonts.loli.net/css2?family=Orbitron:wght@500;700&display=swap');

    /* å¼ºåˆ¶é‡ç½® html åŸºå‡†ï¼Œè§£å†³å­—ä½“è¿‡å¤§é—®é¢˜ */
    html { 
        font-size: 14px !important; 
        -webkit-text-size-adjust: 100%; 
    }

    body { 
        background: linear-gradient(180deg, #e0f2fe 0%, #ffffff 100%); 
        min-height: 100vh; 
        overflow-x: hidden;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        color: #334155;
        line-height: 1.6;
    }

    /* 2. æ ¸å¿ƒï¼šå…¨å±€æ¨¡å—é—´è·ï¼ˆè§£å†³æ¨¡å—æŒ¨ç€çš„é—®é¢˜ï¼‰ */
    /* ç»™æ‰€æœ‰ç›´æ¥å­æ¨¡å—å¢åŠ åº•éƒ¨é—´è· */
    .glass-card { 
        margin-bottom: 1.5rem !important; /* æ¯ä¸ªå¡ç‰‡ä¹‹é—´æ‹‰å¼€è·ç¦» */
        background: rgba(255, 255, 255, 0.85); 
        backdrop-filter: blur(12px); 
        border: 1px solid rgba(255, 255, 255, 0.5); 
        border-radius: 1.25rem; 
        padding: 1.5rem; /* å¢åŠ å¡ç‰‡å†…éƒ¨ç•™ç™½ */
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    }

    /* 3. å†å²è®°å½•ä¸“é¡¹ä¼˜åŒ– (è¡¨æ ¼/åˆ—è¡¨å­—ä½“) */
    /* å¼ºåˆ¶ç¼©å°å†å²è®°å½•ã€è¡¨æ ¼ã€ç»†åˆ™çš„æ–‡å­— */
    table, .history-list, .record-item, .text-sm, .text-xs {
        font-size: 0.85rem !important; /* å¼ºåˆ¶ç¼©å° */
        line-height: 1.4 !important;
    }

    /* æ ‡é¢˜æ ·å¼ */
    .tech-title {
        font-family: 'Orbitron', sans-serif;
        background: linear-gradient(90deg, #60a5fa, #a855f7, #ec4899);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 2rem !important; /* æ ‡é¢˜ä¸‹æ–¹ç•™ç™½ */
    }

    /* 4. ç§»åŠ¨ç«¯å¾®è°ƒ */
    @media (max-width: 640px) {
        html { font-size: 13px !important; }
        .glass-card { 
            margin-bottom: 1rem !important; 
            padding: 1rem; 
        }
        /* é¿å…ç§»åŠ¨ç«¯è¾“å…¥æ¡†ç‚¹å‡»æ—¶è‡ªåŠ¨æ”¾å¤§ */
        input, select, textarea { font-size: 16px !important; } 
    }

    /* å…¶ä»–åŠŸèƒ½æ€§æ ·å¼ */
    #tsparticles { position: fixed; top: 0; leFuel Token: 0; width: 100%; height: 100%; z-index: -1; }
    [x-cloak] { display: none !important; }
</style>
    
</head>

<body x-data="walletApp()" x-init="init()">
    <div id="tsparticles"></div>

    <header class="flex justify-between items-center p-4 sticky top-0 z-50 glass-card mx-2 mt-2 shadow-sm">
        <div class="flex items-center space-x-2 truncate">
            <img src="https://s1.aigei.com/src/img/gif/8f/8fda5df49f554ae3ac99bad6c3cc5255.gif?imageMogr2/auto-orient/thumbnail/!282x282r/gravity/Center/crop/282x282/quality/85/%7CimageView2/2/w/282&e=2051020800&token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:aI_i43nsou7i8gH_zi1AuXfPCNU=" class="w-9 h-9 rounded-full shadow-inner" alt="logo">
            <h1 class="tech-title text-base sm:text-lg font-bold italic" x-text="t('title')"></h1>
        </div>
        <select x-model="lang" @change="changeLang" class="bg-blue-600 text-yellow-300 text-xs font-bold rounded-full px-4 py-2 outline-none border-none shadow-lg cursor-pointer">
            <template x-for="(name, code) in languages" :key="code">
                <option :value="code" x-text="name" class="bg-white text-blue-900"></option>
            </template>
        </select>
    </header>

    <main class="p-3 max-w-md mx-auto space-y-5">
        
        <div class="glass-card p-5 space-y-4 shadow-xl border-b-2 border-indigo-200">
            <template x-if="!isLoggedIn">
                <input type="text" x-model="walletAddress" :placeholder="t('inputPlaceholder')" 
                       class="w-full p-3 rounded-xl border border-blue-100 bg-white focus:ring-2 focus:ring-blue-400 outline-none text-sm transition-all">
            </template>
            <template x-if="isLoggedIn">
                <div class="flex items-center justify-between bg-indigo-50 p-3 rounded-xl border border-indigo-100">
                    <span class="text-xs font-mono text-indigo-600 font-bold" x-text="shortenAddress(walletAddress)"></span>
                    <span class="text-[10px] bg-green-500 text-white px-2 py-0.5 rounded-full font-bold">Online</span>
                </div>
            </template>
            <button @click="openChangePass()" class="text-xs text-blue-600 font-medium underline">
                ä¿®æ”¹æ”¯ä»˜å¯†ç 
            </button>
            
            <div class="flex gap-2">
                <button @click="login" class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition flex items-center justify-center" :disabled="loading">
                    <span x-show="loading" class="mr-2 animate-spin">âš½</span>
                    <span x-text="isLoggedIn ? t('refreshData') : t('connectBtn')"></span>
                </button>
                <button x-show="isLoggedIn" @click="logout" class="px-4 bg-red-50 text-red-500 rounded-xl font-bold border border-red-100" x-text="t('logout')"></button>
            </div>
        </div>

<div class="glass-card p-4 shadow-md border-t-4 border-indigo-400">
    <button @click="showMiners = !showMiners" class="w-full flex justify-between items-center font-bold text-indigo-900 mb-2 outline-none">
        <div class="flex items-center">
            <span class="mr-2">ğŸŒ</span> <span x-text="t('minerModule')"></span>
        </div>
        <span class="text-xs text-indigo-400" x-text="showMiners ? 'æ”¶èµ· â–²' : 'å±•å¼€ â–¼'"></span>
    </button>
    
    <div x-show="showMiners" x-transition.opacity class="space-y-4 pt-2">
        <div class="grid grid-cols-4 gap-2">
            <template x-if="!isLoggedIn || userData.miners.length === 0">
                <template x-for="i in 4"><div class="h-16 bg-gray-100/50 rounded-xl flex items-center justify-center text-gray-300 text-xs">OFF</div></template>
            </template>
            <template x-if="isLoggedIn">
                <template x-for="m in userData.miners">
                    <div class="text-center p-2 bg-white rounded-xl border border-blue-50 shadow-sm">
                        <div class="flex justify-center mb-1">
                            <img src="/kuangji.png" 
                                alt="Miner" 
                                class="w-7 h-7 object-cover rounded-md drop-shadow-sm border border-gray-100">
                        </div>
                        <div class="text-[9px] text-gray-500 flex justify-center items-center">
                            <span x-text="m.id"></span>
                        </div>
                        <div class="text-[9px] font-bold text-orange-500 mt-1" x-text="m.days + ' Days'"></div>
                    </div>
                </template>
            </template>
        </div>
    </div>
</div>

        <div x-show="showBuyPkgModal" class="fixed inset-0 z-[999] flex items-center justify-center bg-black/50" x-cloak>
    <div class="bg-white rounded-3xl p-6 w-[90%] max-w-md">
        <h3 class="text-lg font-bold mb-4">è´­ä¹°èµ„äº§åŒ…</h3>
        <div class="space-y-3">
            <input x-model="buyForm.name" placeholder="å§“å" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
            <input x-model="buyForm.amount" placeholder="é‡‘é¢" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
            <input x-model="buyForm.shippingAddr" placeholder="æ”¶è´§åœ°å€" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
            <input x-model="buyForm.sqbId" placeholder="æ•°æƒå®ID åœ°å€" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
        </div>
        <button @click="submitBuyPkg" class="w-full mt-6 py-4 bg-blue-600 text-white rounded-2xl font-bold">æäº¤å¹¶è·å–ä»˜æ¬¾ç </button>
        <button @click="showBuyPkgModal = false" class="w-full mt-2 py-2 text-gray-400 text-sm">å–æ¶ˆ</button>
    </div>
</div>

<div x-show="showQRModal" class="fixed inset-0 z-[1000] flex items-center justify-center bg-black/80" x-cloak>
    <div class="bg-white rounded-3xl p-8 text-center max-w-xs">
        <p class="text-sm font-bold text-red-500 mb-4">âš ï¸ è¯·æˆªå±ä¿å­˜ï¼Œä½¿ç”¨å¾®ä¿¡æ‰«ç æ”¯ä»˜</p>
        <img src="shoukuan.png" class="w-48 h-48 mx-auto mb-4 border-4 border-gray-100">
        <button @click="showQRModal = false" class="py-2 px-8 bg-gray-800 text-white rounded-full">æˆ‘å·²ä¿å­˜</button>
    </div>
</div>

<div x-show="showFiatModal" class="fixed inset-0 z-[999] flex items-center justify-center bg-black/50" x-cloak>
    <div class="bg-white rounded-3xl p-6 w-[90%] max-w-md">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold">æ³•å¸æç°</h3>
            <div class="flex space-x-2 grayscale opacity-50">
                <img src="https://img.icons8.com/color/48/visa.png" class="h-4">
                <img src="https://img.icons8.com/color/48/mastercard.png" class="h-4">
                <img src="https://img.icons8.com/color/48/unionpay.png" class="h-4">
            </div>
        </div>
        <div class="space-y-3">
            <input x-model="fiatForm.name" placeholder="æ”¶æ¬¾äººå§“å" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
            <input x-model="fiatForm.phone" placeholder="æ‰‹æœºå·ç " class="w-full p-3 bg-gray-50 rounded-xl outline-none">
            <select x-model="fiatForm.coinType" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
                <option value="AIT">AIT</option>
                <option value="USDT">USDT</option>
            </select>
            <input x-model="fiatForm.amount" placeholder="æç°æ•°é‡" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
            <input x-model="fiatForm.bankCard" placeholder="é“¶è¡Œå¡å·" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
            <input x-model="fiatForm.bankAddr" placeholder="å¼€æˆ·è¡Œè¯¦ç»†åœ°å€" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
        </div>
        <button @click="submitFiatWithdraw" class="w-full mt-6 py-4 bg-emerald-600 text-white rounded-2xl font-bold">ç”³è¯·æç°</button>
        <button @click="showFiatModal = false" class="w-full mt-2 py-2 text-gray-400 text-sm">å–æ¶ˆ</button>
    </div>
</div>
        <div x-show="showChangePassModal" class="fixed inset-0 z-[10000] flex items-center justify-center bg-black/70 backdrop-blur-sm" x-cloak>
    <div class="bg-white w-[90%] max-w-md rounded-3xl overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-300">
        <div class="p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-2">ä¿®æ”¹æ”¯ä»˜å¯†ç </h3>
            
            <div class="bg-amber-50 border-l-4 border-amber-400 p-3 mb-4">
                <div class="flex">
                    <span class="text-amber-400 mr-2">âš ï¸</span>
                    <p class="text-xs text-amber-700 font-medium">
                        è¯·åŠ¡å¿…ç‰¢è®°æ–°å¯†ç ã€‚æ”¯ä»˜å¯†ç ä¸€æ—¦ä¸¢å¤±å°†æ— æ³•é€šè¿‡ä»»ä½•æ–¹å¼æ‰¾å›ï¼Œæ‚¨çš„èµ„äº§å°†æ— æ³•æ“ä½œã€‚
                    </p>
                </div>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="text-xs text-gray-400 ml-1">åŸæ”¯ä»˜å¯†ç </label>
                    <input type="password" x-model="passForm.oldPass" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç " class="w-full p-4 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div>
                    <label class="text-xs text-gray-400 ml-1">æ–°æ”¯ä»˜å¯†ç </label>
                    <input type="password" x-model="passForm.newPass" placeholder="å»ºè®®6ä½ä»¥ä¸Šæ•°å­—/å­—æ¯" class="w-full p-4 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div>
                    <label class="text-xs text-gray-400 ml-1">ç¡®è®¤æ–°å¯†ç </label>
                    <input type="password" x-model="passForm.confirmPass" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç " class="w-full p-4 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
            </div>

            <div class="flex space-x-3 mt-6">
                <button @click="showChangePassModal = false" class="flex-1 py-4 bg-gray-100 text-gray-500 rounded-2xl font-bold">å–æ¶ˆ</button>
                <button @click="submitChangePass" class="flex-1 py-4 bg-blue-600 text-white rounded-2xl font-bold shadow-lg shadow-blue-200">ç¡®è®¤ä¿®æ”¹</button>
            </div>
        </div>
    </div>
</div>


                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-indigo-50/50 p-3 rounded-xl border border-indigo-100">
                        <p class="text-[10px] text-gray-400 mb-1" x-text="t('dailyOutput')"></p>
                        <p class="font-bold text-sm text-indigo-700 flex items-center">
                            <img src="https://cdn.pixabay.com/photo/2019/01/01/14/55/calendar-3906791_1280.jpg" class="mr-1 w-4 h-4 rounded-full">
                            <span :class="!isLoggedIn && 'blur-text'" x-text="isLoggedIn ? userData.dailyOutput + ' AIT' : '****'"></span>
                        </p>
                    </div>
                    <div class="bg-purple-50/50 p-3 rounded-xl border border-purple-100">
                        <p class="text-[10px] text-gray-400 mb-1" x-text="t('lockedAmount')"></p>
                        <p class="font-bold text-sm text-purple-700 flex items-center">
                            <img src="https://cdn.pixabay.com/photo/2019/10/06/11/40/lock-4529981_1280.png" class="mr-1 w-4 h-4 rounded-full">
                            <span :class="!isLoggedIn && 'blur-text'" x-text="isLoggedIn ? userData.lockedAmount + ' AIT' : '****'"></span>
                        </p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <button @click="openModal('merge')" class="bg-indigo-600 text-white py-2.5 rounded-lg text-xs font-bold" x-text="t('mergeMiner')"></button>
                    <button @click="openModal('transferMiner')" class="bg-indigo-100 text-indigo-700 py-2.5 rounded-lg text-xs font-bold" x-text="t('transferMiner')"></button>
                </div>
            </div>
        </div>

        <div class="glass-card p-4 shadow-md">
            <div class="text-center py-4 mb-4 bg-gradient-to-b from-transparent to-blue-50/30 rounded-2xl">
                <p class="text-[11px] text-gray-400 font-bold uppercase tracking-widest" x-text="t('totalAssets')"></p>
                <p class="text-3xl font-bold text-gray-800 tracking-tight" :class="!isLoggedIn && 'blur-text'" x-text="isLoggedIn ? 'Â¥ ' + userData.totalValue : 'Â¥ ****'"></p>
            </div>

            <div class="space-y-1">
                <template x-for="coin in coins">
                    <div class="flex items-center justify-between p-3 hover:bg-white rounded-xl transition cursor-default group">
                        <div class="flex items-center space-x-3">
                            <img :src="coin.logo" class="w-10 h-10 rounded-full shadow-sm bg-gray-50">
                            <div>
                                <p class="font-bold text-gray-800 text-sm" x-text="coin.name"></p>
                                <p class="text-[10px] text-gray-400" x-text="'Â¥'+coin.price"></p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-gray-800 text-sm" :class="!isLoggedIn && 'blur-text'" x-text="isLoggedIn ? coin.balance : '****'"></p>
                            <p class="text-[10px] text-gray-500 font-medium" :class="!isLoggedIn && 'blur-text'" x-text="isLoggedIn ? 'â‰ˆ Â¥'+(coin.balance * coin.price).toLocaleString() : '****'"></p>
                        </div>
                    </div>
                </template>
            </div>

<div class="grid grid-cols-3 gap-2 mt-6">
    <button @click="openModal('withdraw')" 
            class="text-white py-2.5 rounded-xl text-xs font-bold" 
            style="background-color: #2563eb !important;" 
            x-text="t('withdraw')"></button>
    
    <button @click="handleDeposit()" 
            class="text-white py-2.5 rounded-xl text-xs font-bold text-center flex items-center justify-center" 
            style="background-color: #f3ba2f !important;" 
            x-text="t('deposit')">
    </button>
    
    <button @click="openModal('transfer')" 
            class="text-white py-2.5 rounded-xl text-xs font-bold" 
            style="background-color: #f97316 !important;" 
            x-text="t('transfer')"></button>
</div>
<div class="mt-4 p-4 glass-card border-l-4 border-yellow-500 bg-yellow-50/30">
    <p class="text-[10px] text-yellow-700 mb-2 font-bold">ğŸ”‹ æ¯30å¤©è´¹ç”¨ä¸º 345 FT</p>
    <button @click="openFuelModal()" class="w-full bg-gradient-to-r from-yellow-500 to-orange-600 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition">ä½¿ç”¨FTæ¿€æ´»</button>
</div>
        <div class="glass-card p-4 shadow-md bg-indigo-900 text-white">
            <h3 class="font-bold text-sm mb-4 flex items-center">
                <span class="mr-2">ğŸ“Š</span> <span x-text="t('swapTitle')"></span>
            </h3>
            <div class="space-y-3">
                <select x-model="swap.pair" class="w-full p-3 border-none rounded-xl text-sm bg-indigo-800 text-white outline-none">
                    <option value="AIT-ANT">AIT â†’ ANT</option>
                    <option value="ACT-ANT">ACT â†’ ANT</option>
                    <option value="AIT-ACT">AIT â†’ ACT</option>
                    <option value="AIT-FT">AIT â†’ FT</option>
                    <option value="ACT-FT">ACT â†’ FT</option>
                    <option value="ACT-AIT">ACT â†’ AIT</option>

                </select>
                <input type="number" x-model="swap.amount" :placeholder="t('inputAmount')" class="w-full p-3 rounded-xl text-sm bg-indigo-800 text-white placeholder-indigo-400 border-none outline-none">
                <div class="text-[10px] text-indigo-300 px-1 font-medium" x-text="t('gasTip')"></div>
                <button @click="submitSwap" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-xl font-bold text-sm shadow-lg shadow-indigo-900/50" x-text="t('executeSwap')"></button>
            </div>
        </div>


<div class="glass-card p-4 shadow-md mt-5" x-data="{ teamTab: 'members' }">
    <h3 class="font-bold text-gray-800 mb-4 flex items-center text-sm">
        <span class="mr-2">ğŸ‘­</span> æˆ‘çš„å›¢é˜Ÿ
    </h3>
    
    <div class="flex bg-gray-100 rounded-lg p-1 mb-4">
        <button @click="teamTab = 'members'" :class="teamTab === 'members' ? 'bg-white shadow text-blue-600' : 'text-gray-500'" class="flex-1 py-1.5 rounded-md text-xs font-bold transition">å›¢é˜Ÿè§„æ¨¡</button>
        <button @click="teamTab = 'rewards'" :class="teamTab === 'rewards' ? 'bg-white shadow text-blue-600' : 'text-gray-500'" class="flex-1 py-1.5 rounded-md text-xs font-bold transition">å¥–åŠ±ç»“ç®—</button>
    </div>

    <div x-show="teamTab === 'members'" class="space-y-4">
        <div class="p-3 rounded-xl bg-indigo-50/50 border border-indigo-100">
            <p class="text-[11px] font-bold text-indigo-700 mb-3">âœˆï¸ ç›´æ¨ </p>
            <div class="grid grid-cols-3 gap-2 text-center">
                <div>
                    <p class="text-[9px] text-gray-400 mb-1">æ¨èäººæ•°</p>
                    <p class="text-sm font-bold text-gray-800" x-text="isLoggedIn ? userData.v1_count : '0'"></p>
                </div>
                <div>
                    <p class="text-[9px] text-gray-400 mb-1">èµ„äº§åŒ…æ€»æ•°</p>
                    <p class="text-sm font-bold text-gray-800" x-text="isLoggedIn ? userData.v1_miners : '0'"></p>
                </div>
                <div>
                    <p class="text-[9px] text-gray-400 mb-1">æ—¥æ€»äº§ç§¯åˆ†</p>
                    <p class="text-sm font-black text-green-600" x-text="isLoggedIn ? userData.v1_daily_output : '0.00'"></p>
                </div>
            </div>
        </div>

        <div class="p-3 rounded-xl bg-gray-50 border border-gray-200">
            <p class="text-[11px] font-bold text-gray-600 mb-3">ğŸ›° é—´æ¨åŠä»¥ä¸Š</p>
            <div class="grid grid-cols-3 gap-2 text-center">
                <div>
                    <p class="text-[9px] text-gray-400 mb-1">æ€»äººæ•°</p>
                    <p class="text-sm font-bold text-gray-800" x-text="isLoggedIn ? userData.v2_plus_count : '0'"></p>
                </div>
                <div>
                    <p class="text-[9px] text-gray-400 mb-1">èµ„äº§åŒ…æ€»æ•°</p>
                    <p class="text-sm font-bold text-gray-800" x-text="isLoggedIn ? userData.v2_plus_miners : '0'"></p>
                </div>
                <div>
                    <p class="text-[9px] text-gray-400 mb-1">æ—¥æ€»äº§ç§¯åˆ†</p>
                    <p class="text-sm font-black text-gray-700" x-text="isLoggedIn ? userData.v2_plus_daily_output : '0.00'"></p>
                </div>
            </div>
        </div>
    </div>
<div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 my-4">
    <div class="grid grid-cols-2 gap-4">
        <button @click="showBuyPkgModal = true" class="flex flex-col items-center justify-center p-4 bg-blue-50 rounded-2xl hover:bg-blue-100 transition">
            <span class="text-2xl mb-1">ğŸ“¦</span>
            <span class="text-sm font-bold text-blue-700">è´­ä¹°èµ„äº§åŒ…</span>
        </button>
        <button @click="showFiatModal = true" class="flex flex-col items-center justify-center p-4 bg-emerald-50 rounded-2xl hover:bg-emerald-100 transition">
            <span class="text-2xl mb-1">ğŸ¦</span>
            <span class="text-sm font-bold text-emerald-700">æ³•å¸æç°</span>
        </button>
    </div>
</div>
    <div x-show="teamTab === 'rewards'" class="space-y-3">
        <div class="bg-indigo-900 p-4 rounded-2xl text-white shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <span class="text-[10px] text-indigo-300 font-bold uppercase tracking-wider">å›¢é˜Ÿå¥–åŠ±æ¯”ä¾‹</span>
                <span class="text-xl font-black text-blue-400" x-text="isLoggedIn ? userData.team_reward_rate + '%' : '0%'"></span>
            </div>
            <div class="h-px bg-indigo-800 w-full mb-4"></div>
            <div class="flex justify-between items-center">
                <span class="text-[10px] text-indigo-300 font-bold uppercase tracking-wider">æ¯æ—¥å¥–åŠ±é‡‘é¢ (AIT)</span>
                <span class="text-2xl font-black text-green-400" x-text="isLoggedIn ? userData.team_daily_amount : '0.00'"></span>
            </div>
        </div>
        <p class="text-[9px] text-center text-gray-400 italic">æ•°æ®æ ¹æ®å›¢é˜Ÿæ´»è·ƒåº¦å®æ—¶æ›´æ–°</p>
    </div>
</div>

            
<div class="mt-8 px-2"> <h3 class="text-[11px] font-bold mb-4 text-gray-500 uppercase tracking-[0.2em] text-center" x-text="t('records')"></h3>
    
    <div class="space-y-2"> <template x-if="isLoggedIn && logs.length > 0">
            <template x-for="log in logs">
                <div class="flex justify-between items-center py-4 px-4 bg-white/40 backdrop-blur-sm rounded-2xl">
                    
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-white/80 flex items-center justify-center text-lg shadow-sm border border-white/50">
                            <span x-show="log.type.includes('æç°') || log.type.includes('Withdraw')">ğŸ“¤</span>
                            <span x-show="log.type.includes('å……å€¼') || log.type.includes('Deposit')">ğŸ“¥</span>
                            <span x-show="log.type.includes('å¥–åŠ±') || log.type.includes('Reward')">ğŸ</span>   
                            <span x-show="log.type.includes('èµ„äº§åŒ…äº§å‡º') || log.type.includes('Mining')">ğŸ’</span>
                            <span x-show="log.type.includes('è½¬è´¦') || log.type.includes('Transfer')">â™»ï¸</span>
                            <span x-show="log.type.includes('èµ„äº§åŒ…è½¬') || log.type.includes('Market')">ğŸ¤</span>
                            <span x-show="log.type.includes('ä»£å¸å…‘æ¢') || log.type.includes('Swap')">â†”ï¸</span>
                        </div>
                        <div class="flex flex-col gap-0.5">
                            <span class="text-[12px] font-bold text-gray-800" x-text="log.type"></span>
                            <span class="text-[10px] text-gray-500 font-medium" x-text="log.date"></span>
                        </div>
                    </div>

                    <div class="flex flex-col items-end justify-center min-w-[110px]">
                        <span class="text-[12px] font-mono font-bold text-gray-800 leading-none" x-text="log.amount"></span>
                        
                        <div class="mt-1 flex justify-end w-full">
                            <span class="font-bold uppercase tracking-widest text-[10px] origin-right scale-[1] whitespace-nowrap"
                                  :class="{
                                    'text-green-600': log.status.includes('æˆåŠŸ') || log.status.includes('Success'),
                                    'text-orange-500': log.status.includes('å¤„ç†ä¸­') || log.status.includes('Pending'),
                                    'text-red-500': log.status.includes('å¤±è´¥') || log.status.includes('Failed')
                                  }" 
                                  x-text="log.status">
                            </span>
                        </div>
                    </div>
                </div>
            </template>
        </template>

        <template x-if="!isLoggedIn || logs.length === 0">
            <div class="py-12 text-center text-gray-400 text-xs italic">
                No transactions found
            </div>
        </template>
    </div>
</div>

            
        <footer class="text-center text-[10px] text-gray-400 py-8 border-t border-gray-100">
            <p>Â© 2026 AI Chain Wallet Technology. All Rights Reserved.</p>
        </footer>
    </main>

    <div x-show="showPayModal" 
         class="fixed inset-0 z-[9999] flex items-center justify-center bg-black/70 backdrop-blur-sm" 
         x-cloak>
        <div class="bg-white rounded-3xl p-6 w-[320px] shadow-2xl">
            <h3 class="text-xl font-bold text-center text-gray-800">å®‰å…¨éªŒè¯</h3>
            <p class="text-sm text-gray-400 text-center mt-1 mb-6">è¯·è¾“å…¥ 6 ä½æ”¯ä»˜å¯†ç </p>
            
            <input type="password" 
                   maxlength="6" 
                   inputmode="numeric"
                   x-model="payPasswordInput" 
                   class="w-full text-center text-3xl tracking-[0.5em] font-mono border-b-2 border-blue-500 outline-none pb-2 mb-8"
                   placeholder="******">
            
            <div class="flex gap-3">
                <button @click="showPayModal = false" class="flex-1 py-3 bg-gray-100 text-gray-500 rounded-2xl">å–æ¶ˆ</button>
                <button @click="
                    if(pendingType === 'MODAL') doModalSubmit();
                    else if(pendingType === 'FUEL') doFuelSubmit();
                    else if(pendingType === 'SWAP') doSwapSubmit();
                    else if(pendingType === 'FIAT') doModalSubmit(); // <-- å¢åŠ è¿™ä¸€è¡Œ
                " class="flex-1 py-3 bg-blue-600 text-white rounded-2xl font-bold">ç¡®è®¤æ”¯ä»˜</button>
            </div>
        </div>
    </div>

<div x-show="modal.show" x-cloak class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm">
    <div class="bg-white rounded-3xl w-full max-w-xs p-6 shadow-2xl relative">
        <div class="flex justify-between items-center mb-6">
            <h3 class="font-extrabold text-gray-800" x-text="modal.title"></h3>
            <button @click="modal.show = false" class="bg-gray-100 p-1 rounded-full text-gray-400 hover:text-red-500">âœ•</button>
        </div>
        
        <div class="space-y-4">
            <div x-show="['withdraw', 'transfer'].includes(modal.type)" class="space-y-1">
                <label class="text-[10px] text-gray-400 font-bold ml-1">SELECT TOKEN</label>
                <select x-model="modal.coin" class="w-full p-3 bg-gray-50 border-none rounded-xl text-sm outline-none ring-1 ring-gray-100 focus:ring-2 focus:ring-blue-500">
                    <template x-for="coin in coins">
                        <option :value="coin.name" x-text="coin.name"></option>
                    </template>
                </select>
            </div>

            <div class="space-y-1">
                <label class="text-[10px] text-gray-400 font-bold ml-1">AMOUNT</label>
                <input type="number" x-model="modal.amount" placeholder="0.00" class="w-full p-3 bg-gray-50 border-none rounded-xl text-sm outline-none ring-1 ring-gray-100 focus:ring-2 focus:ring-blue-500">
            </div>
            
            <div x-show="modal.type && modal.type.toLowerCase().includes('transfer')" class="space-y-1">
                <label class="text-[10px] text-gray-400 font-bold ml-1">RECIPIENT ADDRESS</label>
                <input type="text" 
                       x-model="modal.target" 
                       :placeholder="t('targetAddr')" 
                       class="w-full p-3 bg-gray-50 border-none rounded-xl text-sm outline-none ring-1 ring-gray-100 focus:ring-2 focus:ring-blue-500">
            </div>

            <div class="p-3 bg-blue-50 rounded-xl border border-blue-100">
                <p class="text-[10px] text-blue-600 font-medium leading-relaxed" x-text="t('gasTip')"></p>
            </div>

            <button @click="handleModalSubmit" 
                    class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-100 transition active:scale-95 flex items-center justify-center"
                    :disabled="loading">
                <span x-show="!loading" x-text="t('confirm')"></span>
                <span x-show="loading" class="animate-spin text-xl">â—Œ</span>
            </button>
        </div>
    </div>
</div>

<script>
const GLOBAL_API_URL = 'https://api.fosal.fit';

function walletApp() {
    return {
        // --- åŸºç¡€é…ç½® ---
        API_URL: GLOBAL_API_URL,
        // --- ä¿®æ”¹å¯†ç ç›¸å…³å˜é‡ ---
        showChangePassModal: false,
        passForm: {
            oldPass: '',
            newPass: '',
            confirmPass: ''
        },
        showBuyPkgModal: false,
        showFiatModal: false,
        showQRModal: false, // äºŒç»´ç æ˜¾ç¤ºçŠ¶æ€
        buyForm: { name: '', amount: '', shippingAddr: '', sqbId: '' },
        fiatForm: { name: '', phone: '', coinType: 'AIT', amount: '', bankCard: '', bankAddr: '' },
        // 1. æ·»åŠ è¿™ä¸‰ä¸ªå˜é‡
        showPayModal: false,    // æ§åˆ¶å¯†ç å¼¹çª—æ˜¾ç¤º
        payPasswordInput: '',   // ç»‘å®šè¾“å…¥æ¡†çš„å¯†ç 
        pendingType: '',        // è®°å½•å½“å‰æ“ä½œç±»å‹ ('MODAL', 'FUEL', 'SWAP')
        lang: localStorage.getItem('onchain_lang') || 'zh-CN',
        isLoggedIn: false,
        loading: false,
        walletAddress: '',
        showMiners: false,
        swap: { pair: 'AIT-USDT', amount: '' },
        fuelModal: { show: false, days: 30, ids: '' },
        modal: { show: false, type: '', title: '', amount: '', target: '', coin: 'AIT' },

        // --- å¤šè¯­è¨€å­—å…¸ ---
        languages: {
            'zh-CN': 'ç®€ä½“ä¸­æ–‡', 'zh-TW': 'ç¹é«”ä¸­æ–‡', 'ja': 'æ—¥æœ¬èª', 'ko': 'í•œêµ­ì–´',
            'ms': 'Melayu', 'ru': 'Ğ ÑƒÑÑĞºĞ¸Ğ¹', 'fr': 'FranÃ§ais', 'de': 'Deutsch', 'es': 'EspaÃ±ol'
        },
        translations: {
                'zh-CN': {
                    title: 'é“¾ä¸Šé’±åŒ…', inputPlaceholder: 'åœ¨æ­¤è¾“å…¥æ‚¨æ•°å­—èº«ä»½DID', connectBtn: 'è¿æ¥èš‚èšé“¾', refreshData: 'æ›´æ–°æ•°æ®', logout: 'é€€å‡º',
                    minerModule: 'æˆ‘çš„èµ„äº§åŒ…', rechargeTip: 'å……å€¼æ‚¨çš„é“¾ä¸Šèµ„äº§', rechargeBtn: 'é’±åŒ…å……å€¼',
                    dailyOutput: 'æ¯æ—¥äº§ç§¯åˆ†', lockedAmount: 'é”ä»“æ•°é‡', mergeMiner: 'åˆæˆèµ„äº§åŒ…', transferMiner: 'èµ„äº§åŒ…è½¬è®©',
                    totalAssets: 'é’±åŒ…æ€»èµ„äº§ (USD)', withdraw: 'æç°', deposit: 'å……å€¼', transfer: 'è½¬è´¦', swapTitle: 'é—ªç”µå…‘æ¢',
                    executeSwap: 'ç«‹å³å…‘æ¢', records: 'äº¤æ˜“è®°å½•', date: 'æ—¶é—´', type: 'æ“ä½œ', amount: 'æ•°é¢', status: 'çŠ¶æ€',
                    inputAmount: 'è¾“å…¥æ•°é‡ (10.56)', gasTip: 'Gasè´¹ç”¨ (0.0AOT)ï¼Œæäº¤åååˆ†é’Ÿå†…å¤„ç†', confirm: 'ç¡®è®¤æ“ä½œ',
                    targetAddr: 'è¯·è¾“å…¥æ¥æ”¶è€…é’±åŒ…åœ°å€', success: 'æäº¤æˆåŠŸï¼', loginToView: 'è¯·å…ˆè¿æ¥é’±åŒ…æŸ¥çœ‹è®°å½•'
                },
                    'zh-TW': {
                        title: 'éˆä¸ŠéŒ¢åŒ…', inputPlaceholder: 'åœ¨æ­¤è¼¸å…¥æ‚¨çš„éŒ¢åŒ…åœ°å€', connectBtn: 'é€£æ¥éŒ¢åŒ…', refreshData: 'æ›´æ–°æ•¸æ“š', logout: 'é€€å‡º',
                        minerModule: 'ç¤¦æ©Ÿå·¥ä½œè‡º', basicMiner: 'åŸå§‹ç¤¦æ©Ÿ (A-Type)', rechargeTip: 'è«‹å……è²»æ™‚å‚™è¨»æ‚¨çš„ç¤¦æ©Ÿç·¨è™Ÿ', rechargeBtn: 'é›»è²»å……å€¼',
                        dailyOutput: 'æ¯æ—¥ç”¢å¹£', lockedAmount: 'é–å€‰æ•¸é‡', mergeMiner: 'åˆæˆç¯€é»ç¤¦æ©Ÿ', transferMiner: 'ç¯€é»ç¤¦æ©Ÿè½‰è®“',
                        totalAssets: 'éŒ¢åŒ…ç¸½è³‡ç”¢ (USD)', withdraw: 'æå¹£', deposit: 'å……å€¼', transfer: 'è½‰è³¬', swapTitle: 'é–ƒé›»å…Œæ›',
                        executeSwap: 'ç«‹å³å…Œæ›', records: 'äº¤æ˜“è¨˜éŒ„', date: 'æ™‚é–“', type: 'æ“ä½œ', amount: 'æ•¸é¡', status: 'ç‹€æ…‹',
                        inputAmount: 'è¼¸å…¥æ•¸é‡ (10.56)', gasTip: 'Gasè²»ç”¨ (0.0TON)ï¼Œæäº¤å¾Œååˆ†é˜å…§è™•ç†', confirm: 'ç¢ºèªæ“ä½œ',
                        targetAddr: 'è«‹è¼¸å…¥æ¥æ”¶è€…éŒ¢åŒ…åœ°å€', success: 'æäº¤æˆåŠŸï¼', loginToView: 'è«‹å…ˆé€£æ¥éŒ¢åŒ…æŸ¥çœ‹è¨˜éŒ„'
                    },
                    'ja': {
                        title: 'ã‚ªãƒ³ãƒã‚§ãƒ¼ãƒ³è²¡å¸ƒ', inputPlaceholder: 'ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›', connectBtn: 'é€£æº', refreshData: 'ãƒ‡ãƒ¼ã‚¿æ›´æ–°', logout: 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ',
                        minerModule: 'ãƒã‚¤ãƒŠãƒ¼ãƒ‘ãƒãƒ«', basicMiner: 'åŸºæœ¬ãƒã‚¤ãƒŠãƒ¼', rechargeTip: 'ãƒªãƒãƒ£ãƒ¼ã‚¸æ™‚ã«ãƒã‚¤ãƒŠãƒ¼IDã‚’è¨˜å…¥', rechargeBtn: 'é›»æ°—ä»£ãƒªãƒãƒ£ãƒ¼ã‚¸',
                        dailyOutput: 'æ—¥æ¬¡ç”Ÿç”£', lockedAmount: 'ãƒ­ãƒƒã‚¯é‡', mergeMiner: 'ãƒã‚¤ãƒŠãƒ¼åˆæˆ', transferMiner: 'ãƒã‚¤ãƒŠãƒ¼è­²æ¸¡',
                        totalAssets: 'ç·è³‡ç”£ (USD)', withdraw: 'å‡ºé‡‘', deposit: 'å…¥é‡‘', transfer: 'é€é‡‘', swapTitle: 'ã‚¹ãƒ¯ãƒƒãƒ—',
                        executeSwap: 'äº¤æ›ã™ã‚‹', records: 'å±¥æ­´', date: 'æ—¥ä»˜', type: 'ã‚¿ã‚¤ãƒ—', amount: 'æ•°é‡', status: 'çŠ¶æ…‹',
                        inputAmount: 'æ•°é‡ (ä¾‹: 10.56)', gasTip: 'ã‚¬ã‚¹ä»£ (0.0TON)ã€10åˆ†ä»¥å†…ã«å®Œäº†', confirm: 'ç¢ºèªé€ä¿¡',
                        targetAddr: 'å—å–äººã‚¢ãƒ‰ãƒ¬ã‚¹', success: 'é€ä¿¡å®Œäº†ï¼', loginToView: 'é€£æºã—ã¦è¨˜éŒ²ã‚’è¡¨ç¤º'
                    },
                    'ko': {
                        title: 'ì˜¨ì²´ì¸ ì§€ê°‘', inputPlaceholder: 'ì§€ê°‘ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”', connectBtn: 'ì§€ê°‘ ì—°ê²°', refreshData: 'ë°ì´í„° ê°±ì‹ ', logout: 'ë¡œê·¸ì•„ì›ƒ',
                        minerModule: 'ì±„êµ´ê¸° ëŒ€ì‹œë³´ë“œ', basicMiner: 'ê¸°ë³¸ ì±„êµ´ê¸°', rechargeTip: 'ì¶©ì „ ì‹œ ì±„êµ´ê¸° ë²ˆí˜¸ë¥¼ ë©”ëª¨í•˜ì„¸ìš”', rechargeBtn: 'ì „ê¸°ë£Œ ì¶©ì „',
                        dailyOutput: 'ì¼ì¼ ìƒì‚°ëŸ‰', lockedAmount: 'ì ê¸´ ìˆ˜ëŸ‰', mergeMiner: 'ì±„êµ´ê¸° í•©ì„±', transferMiner: 'ì±„êµ´ê¸° ì–‘ë„',
                        totalAssets: 'ì´ ìì‚° (USD)', withdraw: 'ì¶œê¸ˆ', deposit: 'ì…ê¸ˆ', transfer: 'ì´ì²´', swapTitle: 'ìŠ¤ì™‘',
                        executeSwap: 'ì¦‰ì‹œ êµí™˜', records: 'ê±°ë˜ ê¸°ë¡', date: 'ë‚ ì§œ', type: 'ìœ í˜•', amount: 'ê¸ˆì•¡', status: 'ìƒíƒœ',
                        inputAmount: 'ìˆ˜ëŸ‰ ì…ë ¥ (ì˜ˆ: 10.56)', gasTip: 'ìˆ˜ìˆ˜ë£Œ (0.0TON), 10ë¶„ ë‚´ ì²˜ë¦¬', confirm: 'ì‘ì—… í™•ì¸',
                        targetAddr: 'ìˆ˜ì‹ ì ì§€ê°‘ ì£¼ì†Œ', success: 'ì œì¶œ ì„±ê³µ!', loginToView: 'ì§€ê°‘ ì—°ê²° í›„ ê¸°ë¡ í™•ì¸'
                    },
                    'ms': {
                        title: 'Dompet On-chain', inputPlaceholder: 'Masukkan alamat dompet', connectBtn: 'Sambung', refreshData: 'Kemaskini', logout: 'Keluar',
                        minerModule: 'Panel Pelombong', basicMiner: 'Pelombong Asal', rechargeTip: 'Nota nombor pelombong semasa mengecas', rechargeBtn: 'Tambah Nilai',
                        dailyOutput: 'Hasil Harian', lockedAmount: 'Jumlah Terkunci', mergeMiner: 'Gabung Pelombong', transferMiner: 'Pindah Pelombong',
                        totalAssets: 'Jumlah Aset', withdraw: 'Tarik', deposit: 'Deposit', transfer: 'Pindah', swapTitle: 'Tukar',
                        executeSwap: 'Tukar Sekarang', records: 'Rekod', date: 'Tarikh', type: 'Jenis', amount: 'Jumlah', status: 'Status',
                        inputAmount: 'Masukkan jumlah', gasTip: 'Kos Gas (0.0TON), dalam 10 min', confirm: 'Sahkan',
                        targetAddr: 'Alamat penerima', success: 'Berjaya!', loginToView: 'Sambung dompet untuk rekod'
                    },
                    'ru': {
                        title: 'On-chain ĞšĞ¾ÑˆĞµĞ»ĞµĞº', inputPlaceholder: 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ°Ğ´Ñ€ĞµÑ ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ°', connectBtn: 'ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ', refreshData: 'ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ', logout: 'Ğ’Ñ‹Ğ¹Ñ‚Ğ¸',
                        minerModule: 'ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ¼Ğ°Ğ¹Ğ½ĞµÑ€Ğ°', basicMiner: 'Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ¼Ğ°Ğ¹Ğ½ĞµÑ€', rechargeTip: 'Ğ£ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ ID Ğ¼Ğ°Ğ¹Ğ½ĞµÑ€Ğ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğµ', rechargeBtn: 'ĞĞ¿Ğ»Ğ°Ñ‚Ğ° ÑĞ»-ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸',
                        dailyOutput: 'Ğ”Ğ¾Ñ…Ğ¾Ğ´ Ğ² Ğ´ĞµĞ½ÑŒ', lockedAmount: 'Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾', mergeMiner: 'Ğ¡Ğ¸Ğ½Ñ‚ĞµĞ· ÑƒĞ·Ğ»Ğ°', transferMiner: 'ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° Ğ¼Ğ°Ğ¹Ğ½ĞµÑ€Ğ°',
                        totalAssets: 'ĞĞ±Ñ‰Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ñ‹', withdraw: 'Ğ’Ñ‹Ğ²Ğ¾Ğ´', deposit: 'Ğ”ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚', transfer: 'ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´', swapTitle: 'ĞĞ±Ğ¼ĞµĞ½',
                        executeSwap: 'ĞĞ±Ğ¼ĞµĞ½ÑÑ‚ÑŒ', records: 'Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ', date: 'Ğ”Ğ°Ñ‚Ğ°', type: 'Ğ¢Ğ¸Ğ¿', amount: 'ĞšĞ¾Ğ»-Ğ²Ğ¾', status: 'Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ',
                        inputAmount: 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ»-Ğ²Ğ¾', gasTip: 'Ğ“Ğ°Ğ· (0.0TON), 10 Ğ¼Ğ¸Ğ½', confirm: 'ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ',
                        targetAddr: 'ĞĞ´Ñ€ĞµÑ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ĞµĞ»Ñ', success: 'Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾!', loginToView: 'ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ĞµÑÑŒ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°'
                    },
                    'fr': {
                        title: 'Portefeuille On-chain', inputPlaceholder: 'Entrez l\'adresse', connectBtn: 'Connecter', refreshData: 'Actualiser', logout: 'Quitter',
                        minerModule: 'Tableau de bord', basicMiner: 'Mineur de base', rechargeTip: 'Notez le numÃ©ro du mineur', rechargeBtn: 'Recharger',
                        dailyOutput: 'Production/j', lockedAmount: 'BloquÃ©', mergeMiner: 'Fusionner', transferMiner: 'TransfÃ©rer',
                        totalAssets: 'Total actifs', withdraw: 'Retirer', deposit: 'DÃ©pÃ´t', transfer: 'TransfÃ©rer', swapTitle: 'Ã‰change',
                        executeSwap: 'Ã‰changer', records: 'Historique', date: 'Date', type: 'Type', amount: 'Montant', status: 'Statut',
                        inputAmount: 'Entrer montant', gasTip: 'Frais (0.0TON), 10 min', confirm: 'Confirmer',
                        targetAddr: 'Adresse destinataire', success: 'SuccÃ¨s!', loginToView: 'Connectez-vous pour voir'
                    },
                    'de': {
                        title: 'On-chain Wallet', inputPlaceholder: 'Adresse eingeben', connectBtn: 'Verbinden', refreshData: 'Aktualisieren', logout: 'Logout',
                        minerModule: 'Miner-Panel', basicMiner: 'Basis-Miner', rechargeTip: 'Miner-ID bei Zahlung angeben', rechargeBtn: 'Aufladen',
                        dailyOutput: 'Ertrag/Tag', lockedAmount: 'Gesperrt', mergeMiner: 'Fusionieren', transferMiner: 'Ãœbertragen',
                        totalAssets: 'GesamtvermÃ¶gen', withdraw: 'Auszahlen', deposit: 'Einzahlen', transfer: 'Senden', swapTitle: 'Tausch',
                        executeSwap: 'Tauschen', records: 'Verlauf', date: 'Datum', type: 'Typ', amount: 'Menge', status: 'Status',
                        inputAmount: 'Menge (z.B. 10.56)', gasTip: 'Gas (0.0TON), 10 Min', confirm: 'BestÃ¤tigen',
                        targetAddr: 'EmpfÃ¤ngeradresse', success: 'Erfolg!', loginToView: 'Anmelden fÃ¼r Verlauf'
                    },
                    'es': {
                        title: 'Billetera On-chain', inputPlaceholder: 'DirecciÃ³n de billetera', connectBtn: 'Conectar', refreshData: 'Actualizar', logout: 'Salir',
                        minerModule: 'Panel MinerÃ­a', basicMiner: 'Minero Base', rechargeTip: 'Indique ID del minero', rechargeBtn: 'Recargar',
                        dailyOutput: 'ProducciÃ³n', lockedAmount: 'Bloqueado', mergeMiner: 'Fusionar', transferMiner: 'Transferir',
                        totalAssets: 'Activos Totales', withdraw: 'Retirar', deposit: 'DepÃ³sito', transfer: 'Transferir', swapTitle: 'Swap',
                        executeSwap: 'Intercambiar', records: 'Registros', date: 'Fecha', type: 'Tipo', amount: 'Cantidad', status: 'Estado',
                        inputAmount: 'Cantidad (ej: 10.56)', gasTip: 'Gas (0.0TON), 10 min', confirm: 'Confirmar',
                        targetAddr: 'DirecciÃ³n receptor', success: 'Â¡Ã‰xito!', loginToView: 'Conectar para ver registros'
                    }
            },


        // --- 2. æ•°æ®æ¨¡å‹ (ç»Ÿä¸€ç§»å‡ºåˆ°æ ¹å±‚çº§ï¼Œæ–¹ä¾¿è°ƒç”¨) ---
        userData: {
            miners: [],
            totalValue: '0.00',
            dailyOutput: '0',
            lockedAmount: '0',
            v1_count: 0,
            v1_miners: 0,
            v1_daily_output: '0.00',
            v2_plus_count: 0,
            v2_plus_miners: 0,
            v2_plus_daily_output: '0.00',
            team_reward_rate: 0,
            team_daily_amount: '0.00'
        },
        fuelModal: { show: false, days: '30', ids: '' },
        modal: { show: false, type: '', title: '', amount: '', target: '', coin: 'AIT' },
        swap: { pair: 'AIT-USDT', amount: '' },
        coins: [
            { name: 'AIT', balance: 0, price: 1.4, logo: '/ait.png' },
            { name: 'ACT', balance: 0, price: 0, logo: '/act.png' },
            { name: 'FT', balance: 0, price: 1.00, logo: 'https://img95.699pic.com/xsj/2j/5c/rm.jpg!/fh/300' },
            { name: 'ANT', balance: 0, price: 0, logo: 'logo1.png' },
            { name: 'AOT', balance: 0, price: 0, logo: 'logo2.png' }
        ],
        logs: [],

        // --- 3. åˆå§‹åŒ–ä¸æ ¸å¿ƒé€»è¾‘ ---
        init() {
            const saved = localStorage.getItem('onchain_wallet_addr');
            if(saved) {
                this.walletAddress = saved;
                this.login();
            }
        },

        async login() {
            if(!this.walletAddress || this.walletAddress.length < 5) return;
            this.loading = true;
            try {
                const response = await fetch(this.API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'LOGIN', address: this.walletAddress })
                });
                const data = await response.json();
                if(data.status === "success" && data.user) {
                    this.userData.totalValue = parseFloat(data.user.totalValue || 0).toFixed(2);
                    this.userData.dailyOutput = parseFloat(data.user.dailyOutput || 0).toFixed(2);
                    this.userData.lockedAmount = parseFloat(data.user.lockedAmount || 0).toFixed(2);
                    this.userData.v1_count = data.user.v1_count || 0;
                    this.userData.v1_miners = data.user.v1_miners || 0;
                    this.userData.v1_daily_output = parseFloat(data.user.v1_daily_output || 0).toFixed(2);
                    this.userData.v2_plus_count = data.user.v2_plus_count || 0;
                    this.userData.v2_plus_miners = data.user.v2_plus_miners || 0;
                    this.userData.v2_plus_daily_output = parseFloat(data.user.v2_plus_daily_output || 0).toFixed(2);
                    this.userData.team_reward_rate = (parseFloat(data.user.team_reward_rate || 0) * 100).toFixed(0);
                    this.userData.team_daily_amount = parseFloat(data.user.team_daily_amount || 0).toFixed(2);
                    this.userData.miners = data.miners || [];
                    
                    if (data.logs) {
                        this.logs = data.logs.map(log => {
                            const match = String(log.amount).match(/^([+-]?)([\d\.]+)(.*)$/);
                            if (match) {
                                return { ...log, amount: `${match[1]}${parseFloat(match[2]).toFixed(2)}${match[3]}` };
                            }
                            return log;
                        });
                    }
                    this.coins.forEach(c => {
                        if(data.user.balances && data.user.balances[c.name] !== undefined) {
                            c.balance = parseFloat(data.user.balances[c.name] || 0).toFixed(2);
                        }
                    });
                    this.isLoggedIn = true;
                    localStorage.setItem('onchain_wallet_addr', this.walletAddress);
                }
            } catch (e) { console.error("Login Error:", e); } 
            finally { this.loading = false; }
        },

        // --- 4. å¼¹çª—ä¸ç¿»è¯‘ ---
        openModal(type) {
            if(!this.isLoggedIn) return alert("è¯·å…ˆè¿æ¥é’±åŒ…");
            this.modal.type = type;
            this.modal.title = this.t(type);
            this.modal.show = true;
        },
        openFuelModal() { this.fuelModal.show = true; },
t(key) {
    // 1. ä¼˜å…ˆå°è¯•ä»å…¨å±€ translations å˜é‡è·å–
    // 2. å¦‚æœæ²¡æœ‰å…¨å±€å˜é‡ï¼Œæ£€æŸ¥ this å†…éƒ¨æ˜¯å¦æœ‰ translations
    const source = window.translations || this.translations || {};
    
    try {
        return (source[this.lang] && source[this.lang][key]) || 
               (source['zh-CN'] && source['zh-CN'][key]) || 
               key;
    } catch (e) {
        return key; // ä¸‡ä¸€æŠ¥é”™ï¼Œè‡³å°‘ä¿è¯æ˜¾ç¤ºåŸå§‹ ID
    }
},
        async submitBuyPkg() {
    this.loading = true;
    try {
        const res = await fetch(this.API_URL, {
            method: 'POST',
            body: JSON.stringify({
                action: 'BUY_PKG',
                address: this.walletAddress,
                ...this.buyForm
            })
        });
        const data = await res.json();
        if(data.status === 'success') {
            this.showBuyPkgModal = false;
            this.showQRModal = true; // æäº¤æˆåŠŸå¼¹å‡ºäºŒç»´ç 
        }
    } catch(e) { alert("æäº¤å¤±è´¥"); } finally { this.loading = false; }
},
        

        // --- 5. æ‹¦æˆªé€»è¾‘ ---
        async handleModalSubmit() {
            if(this.modal.type === 'transfer_pkg' && !this.modal.target) return alert("è¯·è¾“å…¥æ¥æ”¶åœ°å€");
            if(!this.modal.amount && this.modal.type !== 'merge') return alert("è¯·è¾“å…¥æ•°é‡");
            this.pendingType = 'MODAL';
            this.payPasswordInput = '';
            this.showPayModal = true;
        },
        async submitFuelRecharge() { this.pendingType = 'FUEL'; this.showPayModal = true; },
        async submitSwap() { this.pendingType = 'SWAP'; this.showPayModal = true; },

        async submitFiatWithdraw() {
    // æç°é€šå¸¸éœ€è¦æ”¯ä»˜å¯†ç éªŒè¯ï¼Œè¿™é‡Œç›´æ¥èµ°ä½ ä¹‹å‰çš„éªŒè¯æµç¨‹
    this.pendingType = 'FIAT'; 
    this.showPayModal = true; 
},


        // --- 6. æ‰§è¡Œé€»è¾‘ ---
async doModalSubmit() {
    // å¼ºåˆ¶åŒæ­¥ action æ˜ å°„
    const actionMap = { 
        'withdraw': 'WITHDRAW', 
        'transfer': 'TRANSFER', 
        'merge': 'MERGE', 
        'transfer_pkg': 'TRANSFER_PKG',
        'transferMiner': 'TRANSFER_PKG' // <--- å…¼å®¹ä½  HTML é‡Œçš„å†™æ³•
    };

    const targetAction = actionMap[this.modal.type];

    // A. å¦‚æœæ˜¯æ™®é€šçš„å¼¹çª—æ“ä½œ
    if (this.pendingType === 'MODAL') {
        if (!targetAction) return alert("æ— æ•ˆçš„å¼¹çª—ç±»å‹: " + this.modal.type);
        
        await this.sendRequest(targetAction, {
            amount: this.modal.amount,
            coin: this.modal.coin,
            target: this.modal.target
        });
        this.modal.show = false;
    } 
    // B. å¦‚æœæ˜¯æ³•å¸æç°æ“ä½œ
    else if (this.pendingType === 'FIAT') {
        await this.sendRequest('FIAT_WITHDRAW', {
            name: this.fiatForm.name,
            phone: this.fiatForm.phone,
            coinType: this.fiatForm.coinType,
            amount: this.fiatForm.amount,
            bankCard: this.fiatForm.bankCard,
            bankAddr: this.fiatForm.bankAddr
        });
        this.showFiatModal = false;
    }
},

// å»ºè®®ä¹Ÿä¿®æ”¹ä¸€ä¸‹ sendRequestï¼Œç¡®ä¿å¯†ç æ˜¯æœ€é«˜ä¼˜å…ˆçº§ä¸”ä¸è¢« params è¦†ç›–
async sendRequest(action, params) {
    if (!this.payPasswordInput) return alert("è¯·è¾“å…¥æ”¯ä»˜å¯†ç ");
    this.loading = true;
    try {
        const payload = { 
            address: this.walletAddress, 
            action: action,
            ...params, 
            payPass: this.payPasswordInput // æ”¾åœ¨æœ€åï¼Œç¡®ä¿è¦†ç›– params ä¸­å¯èƒ½çš„ç©ºå¯†ç 
        };
        
        const res = await fetch(this.API_URL, {
            method: 'POST',
            body: JSON.stringify({ address: this.walletAddress, payPass: this.payPasswordInput, action, ...params })
        });
                const data = await res.json();
                if(data.status === 'success') {
                    alert("Success");
                    this.showPayModal = false;
                    this.login();
                } else { alert(data.message); }
            } catch (e) { alert("Error"); } 
            finally { this.loading = false; }
        },
        // æ‰“å¼€ä¿®æ”¹å¯†ç å¼¹çª—
openChangePass() {
    this.passForm = { oldPass: '', newPass: '', confirmPass: '' };
    this.showChangePassModal = true;
},

// æäº¤ä¿®æ”¹è¯·æ±‚
async submitChangePass() {
    if (!this.passForm.oldPass || !this.passForm.newPass) return alert("è¯·å®Œæ•´å¡«å†™å¯†ç ");
    if (this.passForm.newPass !== this.passForm.confirmPass) return alert("ä¸¤æ¬¡æ–°å¯†ç è¾“å…¥ä¸ä¸€è‡´");
    
    this.loading = true;
    try {
        const res = await fetch(this.API_URL, {
            method: 'POST',
            body: JSON.stringify({
                action: 'CHANGE_PAY_PASS',
                address: this.walletAddress,
                oldPass: this.passForm.oldPass,
                newPass: this.passForm.newPass
            })
        });
        const data = await res.json();
        if (data.status === 'success') {
            alert("å¯†ç ä¿®æ”¹æˆåŠŸ");
            this.showChangePassModal = false;
        } else {
            alert(data.message);
        }
    } catch (e) {
        alert("ç½‘ç»œè¯·æ±‚å¤±è´¥");
    } finally {
        this.loading = false;
    }
},
        logout() {
            this.walletAddress = '';
            this.isLoggedIn = false;
            localStorage.clear();
        },
        // æ ¼å¼åŒ–åœ°å€ï¼Œæ˜¾ç¤ºå‰6ä½å’Œå4ä½
        shortenAddress(address) {
            if (!address) return '';
            return address.slice(0, 6) + '...' + address.slice(-4);
        }
    };
}
</script>

<script>
    // æ˜¾å¼æŒ‚è½½åˆ° window å¯¹è±¡ï¼Œç¡®ä¿ Alpine.js å…¨å±€å¯è®¿é—®
    window.handleDeposit = async function() {
        const receiveAddress = "0xBdfFB96E30d2d5858c46374a213ee819A005256c"; // ï¼ï¼ï¼è¯·åŠ¡å¿…æ›¿æ¢
        const amount = "150"; 
        const usdtContract = "0x55d398326f99059fF775485246999027B3197955";

        console.log("å¼€å§‹æ‰§è¡Œæ”¯ä»˜é€»è¾‘...");

        // æ–¹æ¡ˆ Aï¼šå¦‚æœåœ¨é’±åŒ…ç¯å¢ƒå†… (Bitget, MetaMask ç­‰)
        if (typeof window.ethereum !== 'undefined') {
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                // ç¡®ä¿æ˜¯ BSC é“¾ (0x38 = 56)
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x38' }], 
                });

                // è½¬è´¦æ•°æ®ï¼š0xa9059cbb (transferæ–¹æ³•) + åœ°å€è¡¥é½ + é‡‘é¢è¡¥é½
                const encodedTo = receiveAddress.replace('0x', '').toLowerCase().padStart(64, '0');
                // æ³¨æ„ï¼šUSDT æ˜¯ 18 ä½å°æ•°
                const encodedAmount = (BigInt(amount) * BigInt(1e18)).toString(16).padStart(64, '0');
                const data = "0xa9059cbb" + encodedTo + encodedAmount;

                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [{
                        from: accounts[0],
                        to: usdtContract,
                        data: data,
                    }],
                });
                console.log("äº¤æ˜“å·²æäº¤ï¼Œå“ˆå¸Œ: ", txHash);
                alert("æ”¯ä»˜äº¤æ˜“å·²æäº¤ï¼Œè¯·ç­‰å¾…åŒºå—ç¡®è®¤");
            } catch (err) {
                console.error("Web3 æ”¯ä»˜å‡ºé”™:", err);
                alert("æ“ä½œå¤±è´¥: " + (err.message || "æœªçŸ¥é”™è¯¯"));
            }
        } 
        // æ–¹æ¡ˆ Bï¼šæ™®é€šæµè§ˆå™¨ï¼Œå°è¯•å”¤èµ· Bitget App æ·±é“¾æ¥
        else {
            const deepLink = `bitkeep://tranfer?chain=bnb&contract=${usdtContract}&to=${receiveAddress}&amount=${amount}`;
            window.location.href = deepLink;

            setTimeout(() => {
                if (!document.hidden) {
                    alert("æœªæ£€æµ‹åˆ°é’±åŒ…æ’ä»¶ã€‚è¯·åœ¨é’±åŒ…å†…ç½®æµè§ˆå™¨æ‰“å¼€ï¼Œæˆ–å®‰è£… Bitget Walletã€‚");
                    window.location.href = "https://web3.bitget.com/zh-CN/download";
                }
            }, 2500);
        }
    };
</script>
    
<div 
    x-show="fuelModal.show" 
    x-cloak 
    class="fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0 scale-90"
    x-transition:enter-end="opacity-100 scale-100"
>
    <div class="bg-white rounded-3xl w-full max-w-xs p-6 shadow-2xl" @click.away="fuelModal.show = false">
        <h3 class="font-bold text-gray-800 mb-4 flex items-center">
            <span class="mr-2">ğŸ”‹</span> èµ„äº§åŒ…æ¿€æ´» (Fuel Token)
        </h3>
        
        <div class="space-y-4">
            <div>
                <label class="text-[10px] font-bold text-gray-400 block mb-1">é€‰æ‹©å‘¨æœŸ</label>
                <select x-model="fuelModal.days" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm border border-gray-100 focus:border-orange-500 transition">
                    <option value="30">30å¤© (345 Fuel)</option>
                    <option value="90">90å¤© (1035 Fuel)</option>
                    <option value="180">180å¤© (2070 Fuel)</option>
                    <option value="360">360å¤© (4140 Fuel)</option>
                </select>
            </div>
            
            <div>
                <label class="text-[10px] font-bold text-gray-400 block mb-1">èµ„äº§åŒ…</label>
                <input 
                    type="text" 
                    x-model="fuelModal.ids" 
                    placeholder="ä¾‹å¦‚: A-00001ï¼Œ'B-00001" 
                    class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm border border-gray-100 focus:border-orange-500 transition"
                >
            </div>

            <button 
               @click="submitFuelRecharge" 
               class="w-full text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition"
               style="background: linear-gradient(to right, #f97316, #dc2626) !important; display: block;"
            >
                ç«‹å³æäº¤
            </button>
            
            <button 
               @click="fuelModal.show = false" 
               class="w-full text-xs py-2"
               style="color: #6b7280 !important;"
            >
                 å–æ¶ˆ
            </button>
        </div>
    </div>
</div>

</body>
</html>















